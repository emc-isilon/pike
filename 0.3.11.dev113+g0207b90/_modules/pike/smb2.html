

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pike.smb2 &mdash; pike-smb2 0.3.11.dev113+g0207b90 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pike-smb2
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../high_level.html">High-Level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autosummary.html">API Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../model.html">Implementation Details</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pike-smb2</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pike.smb2</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pike.smb2</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Copyright (c) 2013-2020, Dell Inc. or its subsidiaries.</span>
<span class="c1"># All rights reserved.</span>
<span class="c1"># See file LICENSE for licensing information.</span>
<span class="c1">#</span>
<span class="c1"># Module Name:</span>
<span class="c1">#</span>
<span class="c1">#        smb2.py</span>
<span class="c1">#</span>
<span class="c1"># Abstract:</span>
<span class="c1">#</span>
<span class="c1">#        SMB2 support</span>
<span class="c1">#</span>
<span class="c1"># Authors: Brian Koropoff (brian.koropoff@emc.com)</span>
<span class="c1">#</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">SMB2 packet definitions</span>

<span class="sd">This module contains definitions of SMB2 packet frames and</span>
<span class="sd">associated constants and data types.</span>

<span class="sd">Packet field names are derived by taking the name from MS-SMB2 and</span>
<span class="sd">making it PEP-8 compliant. For example, FooBarBaz becomes foo_bar_baz.</span>
<span class="sd">This makes it simple to correlate the code with the spec while</span>
<span class="sd">maintaining a clear visual distinction between values and types.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">str</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">range</span>

<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">core</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">nttime</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ntstatus</span>


<span class="c1"># for credit cost calculations</span>
<span class="n">BYTES_PER_CREDIT</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">*</span> <span class="mi">1024</span>


<span class="c1"># Dialects constants</span>
<div class="viewcode-block" id="Dialect"><a class="viewcode-back" href="../../model.html#pike.smb2.Dialect">[docs]</a><span class="k">class</span> <span class="nc">Dialect</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">DIALECT_SMB2_WILDCARD</span> <span class="o">=</span> <span class="mh">0x02FF</span>
    <span class="n">DIALECT_SMB2_002</span> <span class="o">=</span> <span class="mh">0x0202</span>
    <span class="n">DIALECT_SMB2_1</span> <span class="o">=</span> <span class="mh">0x0210</span>
    <span class="n">DIALECT_SMB3_0</span> <span class="o">=</span> <span class="mh">0x0300</span>
    <span class="n">DIALECT_SMB3_0_2</span> <span class="o">=</span> <span class="mh">0x0302</span>
    <span class="n">DIALECT_SMB3_1_1</span> <span class="o">=</span> <span class="mh">0x0311</span></div>


<span class="n">Dialect</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Flag constants</span>
<div class="viewcode-block" id="Flags"><a class="viewcode-back" href="../../model.html#pike.smb2.Flags">[docs]</a><span class="k">class</span> <span class="nc">Flags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_FLAGS_NONE</span> <span class="o">=</span> <span class="mh">0x00000000</span>
    <span class="n">SMB2_FLAGS_SERVER_TO_REDIR</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">SMB2_FLAGS_ASYNC_COMMAND</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">SMB2_FLAGS_RELATED_OPERATIONS</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">SMB2_FLAGS_SIGNED</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">SMB2_FLAGS_DFS_OPERATIONS</span> <span class="o">=</span> <span class="mh">0x10000000</span>
    <span class="n">SMB2_FLAGS_REPLAY_OPERATION</span> <span class="o">=</span> <span class="mh">0x20000000</span></div>


<span class="n">Flags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Command constants</span>
<div class="viewcode-block" id="CommandId"><a class="viewcode-back" href="../../model.html#pike.smb2.CommandId">[docs]</a><span class="k">class</span> <span class="nc">CommandId</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">SMB2_NEGOTIATE</span> <span class="o">=</span> <span class="mh">0x0000</span>
    <span class="n">SMB2_SESSION_SETUP</span> <span class="o">=</span> <span class="mh">0x0001</span>
    <span class="n">SMB2_LOGOFF</span> <span class="o">=</span> <span class="mh">0x0002</span>
    <span class="n">SMB2_TREE_CONNECT</span> <span class="o">=</span> <span class="mh">0x0003</span>
    <span class="n">SMB2_TREE_DISCONNECT</span> <span class="o">=</span> <span class="mh">0x0004</span>
    <span class="n">SMB2_CREATE</span> <span class="o">=</span> <span class="mh">0x0005</span>
    <span class="n">SMB2_CLOSE</span> <span class="o">=</span> <span class="mh">0x0006</span>
    <span class="n">SMB2_FLUSH</span> <span class="o">=</span> <span class="mh">0x0007</span>
    <span class="n">SMB2_READ</span> <span class="o">=</span> <span class="mh">0x0008</span>
    <span class="n">SMB2_WRITE</span> <span class="o">=</span> <span class="mh">0x0009</span>
    <span class="n">SMB2_LOCK</span> <span class="o">=</span> <span class="mh">0x000A</span>
    <span class="n">SMB2_IOCTL</span> <span class="o">=</span> <span class="mh">0x000B</span>
    <span class="n">SMB2_CANCEL</span> <span class="o">=</span> <span class="mh">0x000C</span>
    <span class="n">SMB2_ECHO</span> <span class="o">=</span> <span class="mh">0x000D</span>
    <span class="n">SMB2_QUERY_DIRECTORY</span> <span class="o">=</span> <span class="mh">0x000E</span>
    <span class="n">SMB2_CHANGE_NOTIFY</span> <span class="o">=</span> <span class="mh">0x000F</span>
    <span class="n">SMB2_QUERY_INFO</span> <span class="o">=</span> <span class="mh">0x0010</span>
    <span class="n">SMB2_SET_INFO</span> <span class="o">=</span> <span class="mh">0x0011</span>
    <span class="n">SMB2_OPLOCK_BREAK</span> <span class="o">=</span> <span class="mh">0x0012</span></div>


<span class="n">CommandId</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Share Capabilities</span>
<div class="viewcode-block" id="ShareCaps"><a class="viewcode-back" href="../../model.html#pike.smb2.ShareCaps">[docs]</a><span class="k">class</span> <span class="nc">ShareCaps</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_SHARE_CAP_DFS</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">SMB2_SHARE_CAP_CONTINUOUS_AVAILABILITY</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">SMB2_SHARE_CAP_SCALEOUT</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">SMB2_SHARE_CAP_CLUSTER</span> <span class="o">=</span> <span class="mh">0x00000040</span></div>


<span class="n">ShareCaps</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Share flags</span>
<div class="viewcode-block" id="ShareFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.ShareFlags">[docs]</a><span class="k">class</span> <span class="nc">ShareFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_SHAREFLAG_MANUAL_CACHING</span> <span class="o">=</span> <span class="mh">0x00000000</span>
    <span class="n">SMB2_SHAREFLAG_AUTO_CACHING</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">SMB2_SHAREFLAG_VDO_CACHING</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">SMB2_SHAREFLAG_NO_CACHING</span> <span class="o">=</span> <span class="mh">0x00000030</span>
    <span class="n">SMB2_SHAREFLAG_DFS</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">SMB2_SHAREFLAG_DFS_ROOT</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">SMB2_SHAREFLAG_RESTRICT_EXCLUSIVE_OPENS</span> <span class="o">=</span> <span class="mh">0x00000100</span>
    <span class="n">SMB2_SHAREFLAG_FORCE_SHARED_DELETE</span> <span class="o">=</span> <span class="mh">0x00000200</span>
    <span class="n">SMB2_SHAREFLAG_ALLOW_NAMESPACE_CACHING</span> <span class="o">=</span> <span class="mh">0x00000400</span>
    <span class="n">SMB2_SHAREFLAG_ACCESS_BASED_DIRECTORY_ENUM</span> <span class="o">=</span> <span class="mh">0x00000800</span>
    <span class="n">SMB2_SHAREFLAG_FORCE_LEVELII_OPLOCK</span> <span class="o">=</span> <span class="mh">0x00001000</span>
    <span class="n">SMB2_SHAREFLAG_ENABLE_HASH_V1</span> <span class="o">=</span> <span class="mh">0x00002000</span>
    <span class="n">SMB2_SHAREFLAG_ENABLE_HASH_V2</span> <span class="o">=</span> <span class="mh">0x00004000</span>
    <span class="n">SMB2_SHAREFLAG_ENCRYPT_DATA</span> <span class="o">=</span> <span class="mh">0x00008000</span></div>


<span class="n">ShareFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>

<span class="c1"># Misc</span>
<span class="n">RELATED_FID</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">64</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">64</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">UNSOLICITED_MESSAGE_ID</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">64</span> <span class="o">-</span> <span class="mi">1</span>


<span class="k">class</span> <span class="nc">Smb2</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="n">LOG_CHILDREN_COUNT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">LOG_CHILDREN_EXPAND</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_request_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_response_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_notification_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># Decorators to register class as request/response/notification payload</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_request_table</span><span class="p">,</span> <span class="s2">&quot;command_id&quot;</span><span class="p">,</span> <span class="s2">&quot;structure_size&quot;</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_response_table</span><span class="p">,</span> <span class="s2">&quot;command_id&quot;</span><span class="p">,</span> <span class="s2">&quot;structure_size&quot;</span><span class="p">)</span>
    <span class="n">notification</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_notification_table</span><span class="p">,</span> <span class="s2">&quot;command_id&quot;</span><span class="p">,</span> <span class="s2">&quot;structure_size&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credit_charge</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_sequence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credit_request</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credit_response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SMB2_FLAGS_NONE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_command</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">async_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_str_children</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xfe</span><span class="s2">SMB&quot;</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credit_charge</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_SERVER_TO_REDIR</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_sequence</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="o">.</span><span class="n">command_id</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_SERVER_TO_REDIR</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credit_response</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credit_request</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="c1"># Set NextCommand to 0 for now</span>
        <span class="n">next_command_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_ASYNC_COMMAND</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">async_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mh">0xFEFF</span><span class="p">)</span>  <span class="c1"># default process id</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree_id</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">)</span>
        <span class="c1"># Set Signature to 0 for now</span>
        <span class="n">signature_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>

        <span class="c1"># Encode command body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>

        <span class="c1"># If we are not last command in chain</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_last_child</span><span class="p">():</span>
            <span class="c1"># Add padding</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">trunc</span><span class="p">()</span>

            <span class="c1"># Calculate next_command</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_command</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_command</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">next_command_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_command</span><span class="p">)</span>

        <span class="c1"># Calculate and backpatch signature</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;signature&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_SIGNED</span><span class="p">:</span>
                <span class="n">digest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">signing_digest</span><span class="p">()</span>
                <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">signing_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">digest</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[:</span><span class="n">cur</span><span class="p">])[:</span><span class="mi">16</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>

        <span class="n">signature_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signature</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span> <span class="o">!=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xfe</span><span class="s2">SMB&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">BadPacket</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">64</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">BadPacket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">credit_charge</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="c1"># Look ahead and decode flags first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">Flags</span><span class="p">((</span><span class="n">cur</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_SERVER_TO_REDIR</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ntstatus</span><span class="o">.</span><span class="n">Status</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">channel_sequence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">channel_sequence</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
            <span class="c1"># Ignore reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">CommandId</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_SERVER_TO_REDIR</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credit_response</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credit_request</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credit_request</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credit_response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Skip over flags</span>
        <span class="n">cur</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_command</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_ASYNC_COMMAND</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">async_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ignore reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tree_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">async_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signature</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>

        <span class="c1"># Peek ahead at structure_size</span>
        <span class="n">structure_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>

        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">structure_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_SERVER_TO_REDIR</span><span class="p">:</span>
            <span class="c1"># Distinguish unsoliticed response, error response, normal response</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_id</span> <span class="o">==</span> <span class="n">UNSOLICITED_MESSAGE_ID</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Smb2</span><span class="o">.</span><span class="n">_notification_table</span><span class="p">:</span>
                    <span class="bp">cls</span> <span class="o">=</span> <span class="n">Smb2</span><span class="o">.</span><span class="n">_notification_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">BadPacket</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Smb2</span><span class="o">.</span><span class="n">_response_table</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">Smb2</span><span class="o">.</span><span class="n">_response_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">allowed_status</span>
                    <span class="ow">and</span> <span class="n">structure_size</span> <span class="o">==</span> <span class="n">ErrorResponse</span><span class="o">.</span><span class="n">structure_size</span>
                <span class="p">):</span>
                    <span class="bp">cls</span> <span class="o">=</span> <span class="n">ErrorResponse</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">cls</span> <span class="o">=</span> <span class="n">ErrorResponse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">Smb2</span><span class="o">.</span><span class="n">_request_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># Figure out limit of command data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_command</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_command</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">upperbound</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_command</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>

        <span class="c1"># Advance to next frame or end of data</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">digest</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">SMB2_FLAGS_SIGNED</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>
            <span class="c1"># Zero out signature in message</span>
            <span class="n">message</span><span class="p">[</span><span class="mi">12</span> <span class="o">*</span> <span class="mi">4</span> <span class="p">:</span> <span class="mi">12</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>
            <span class="c1"># Calculate signature</span>
            <span class="n">signature</span> <span class="o">=</span> <span class="n">digest</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">message</span><span class="p">)[:</span><span class="mi">16</span><span class="p">]</span>
            <span class="c1"># Check that signatures match</span>
            <span class="k">if</span> <span class="n">signature</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">signature</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">BadPacket</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_encode_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">_encode_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">_decode_pre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">BadPacket</span><span class="p">()</span>


<span class="nd">@Smb2</span><span class="o">.</span><span class="n">request</span>
<span class="k">class</span> <span class="nc">Request</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="nd">@Smb2</span><span class="o">.</span><span class="n">response</span>
<span class="k">class</span> <span class="nc">Response</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="n">allowed_status</span> <span class="o">=</span> <span class="p">[</span><span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_SUCCESS</span><span class="p">]</span>


<span class="nd">@Smb2</span><span class="o">.</span><span class="n">notification</span>
<span class="k">class</span> <span class="nc">Notification</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">ErrorResponse</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="n">_context_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">error_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_context_table</span><span class="p">,</span> <span class="s2">&quot;error_id&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_status&quot;</span><span class="p">)</span>
    <span class="n">special_statuses</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_STOPPED_ON_SYMLINK</span><span class="p">,</span>
        <span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_BUFFER_TOO_SMALL</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ErrorResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">_command</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byte_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_context_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_contexts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
                <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">command</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_contexts</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_context_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="c1"># Ignore Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byte_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_count</span>

        <span class="c1"># SMB 3.1.1+ Error context handling</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_context_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_context_count</span><span class="p">):</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">data_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
                <span class="n">error_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
                <span class="n">parent_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status</span>
                <span class="k">if</span> <span class="n">parent_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_statuses</span><span class="p">:</span>
                    <span class="n">parent_status</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">error_id</span><span class="p">,</span> <span class="n">parent_status</span><span class="p">)</span>
                <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                    <span class="n">ctx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_length</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># compatability shim for older dialects</span>
            <span class="n">error_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">parent_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">status</span>
            <span class="k">if</span> <span class="n">parent_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">special_statuses</span><span class="p">:</span>
                <span class="n">parent_status</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">error_id</span><span class="p">,</span> <span class="n">parent_status</span><span class="p">)</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_count</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<div class="viewcode-block" id="ErrorId"><a class="viewcode-back" href="../../model.html#pike.smb2.ErrorId">[docs]</a><span class="k">class</span> <span class="nc">ErrorId</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">SMB2_ERROR_ID_DEFAULT</span> <span class="o">=</span> <span class="mh">0x0</span></div>


<span class="n">ErrorId</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="nd">@ErrorResponse</span><span class="o">.</span><span class="n">error_context</span>
<span class="k">class</span> <span class="nc">ErrorResponseContext</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">data_length</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_length</span> <span class="o">=</span> <span class="n">data_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ErrorResponseDefault</span><span class="p">(</span><span class="n">ErrorResponseContext</span><span class="p">):</span>
    <span class="n">error_id</span> <span class="o">=</span> <span class="n">SMB2_ERROR_ID_DEFAULT</span>
    <span class="n">parent_status</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_length</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ErrorResponseDefaultBufferSize</span><span class="p">(</span><span class="n">ErrorResponseContext</span><span class="p">):</span>
    <span class="n">error_id</span> <span class="o">=</span> <span class="n">SMB2_ERROR_ID_DEFAULT</span>
    <span class="n">parent_status</span> <span class="o">=</span> <span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_BUFFER_TOO_SMALL</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_buffer_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span>


<span class="k">class</span> <span class="nc">SymbolicLinkErrorResponse</span><span class="p">(</span><span class="n">ErrorResponseContext</span><span class="p">):</span>
    <span class="n">error_id</span> <span class="o">=</span> <span class="n">SMB2_ERROR_ID_DEFAULT</span>
    <span class="n">parent_status</span> <span class="o">=</span> <span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_STOPPED_ON_SYMLINK</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sym_link_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sym_link_error_tag</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reparse_tag</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_link_error_tag</span> <span class="o">!=</span> <span class="mh">0x4C4D5953</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">BadPacket</span><span class="p">()</span>
        <span class="n">reparse_data</span> <span class="o">=</span> <span class="n">GetReparsePointResponse</span><span class="o">.</span><span class="n">_reparse_tag_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reparse_tag</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span> <span class="o">=</span> <span class="n">reparse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Cancel</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_CANCEL</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># Negotiate constants</span>
<div class="viewcode-block" id="SecurityMode"><a class="viewcode-back" href="../../model.html#pike.smb2.SecurityMode">[docs]</a><span class="k">class</span> <span class="nc">SecurityMode</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_NEGOTIATE_NONE</span> <span class="o">=</span> <span class="mh">0x0000</span>
    <span class="n">SMB2_NEGOTIATE_SIGNING_ENABLED</span> <span class="o">=</span> <span class="mh">0x0001</span>
    <span class="n">SMB2_NEGOTIATE_SIGNING_REQUIRED</span> <span class="o">=</span> <span class="mh">0x0002</span></div>


<span class="n">SecurityMode</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="GlobalCaps"><a class="viewcode-back" href="../../model.html#pike.smb2.GlobalCaps">[docs]</a><span class="k">class</span> <span class="nc">GlobalCaps</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_GLOBAL_CAP_DFS</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">SMB2_GLOBAL_CAP_LEASING</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">SMB2_GLOBAL_CAP_LARGE_MTU</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">SMB2_GLOBAL_CAP_MULTI_CHANNEL</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">SMB2_GLOBAL_CAP_PERSISTENT_HANDLES</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">SMB2_GLOBAL_CAP_DIRECTORY_LEASING</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">SMB2_GLOBAL_CAP_ENCRYPTION</span> <span class="o">=</span> <span class="mh">0x00000040</span></div>


<span class="n">GlobalCaps</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="NegotiateContextType"><a class="viewcode-back" href="../../model.html#pike.smb2.NegotiateContextType">[docs]</a><span class="k">class</span> <span class="nc">NegotiateContextType</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">SMB2_PREAUTH_INTEGRITY_CAPABILITIES</span> <span class="o">=</span> <span class="mh">0x0001</span>
    <span class="n">SMB2_ENCRYPTION_CAPABILITIES</span> <span class="o">=</span> <span class="mh">0x0002</span></div>


<span class="n">NegotiateContextType</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="HashAlgorithms"><a class="viewcode-back" href="../../model.html#pike.smb2.HashAlgorithms">[docs]</a><span class="k">class</span> <span class="nc">HashAlgorithms</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">SMB2_SHA_512</span> <span class="o">=</span> <span class="mh">0x0001</span></div>


<span class="n">HashAlgorithms</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">NegotiateRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_NEGOTIATE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">36</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_guid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_alignment_skew</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span>

    <span class="k">def</span> <span class="nf">_has_negotiate_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialects</span><span class="p">))</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_guid</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_negotiate_contexts</span><span class="p">():</span>
            <span class="n">negotiate_contexts_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reserved</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dialect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialects</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_negotiate_contexts</span><span class="p">():</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">seekto</span><span class="p">(</span><span class="n">cur</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_alignment_skew</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">negotiate_contexts_offset_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_offset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">negotiate_contexts_offset_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">context_type</span><span class="p">)</span>
                <span class="n">data_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reserved</span>
                <span class="n">data_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">ctx</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">data_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ctx</span><span class="o">.</span><span class="n">data_length</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">data_start</span>
                <span class="n">data_length_hole</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">data_length</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NegotiateResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_NEGOTIATE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">65</span>

    <span class="n">_context_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">negotiate_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_context_table</span><span class="p">,</span> <span class="s2">&quot;context_type&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialect_revision</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_guid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_transact_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_read_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_write_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_start_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NegotiateResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialect_revision</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span> <span class="o">=</span> <span class="n">SecurityMode</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialect_revision</span> <span class="o">=</span> <span class="n">Dialect</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_guid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="n">GlobalCaps</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_transact_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_read_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_write_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_start_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="c1"># Advance to security buffer</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">seekto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_offset</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts_count</span><span class="p">):</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">context_type</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
                <span class="n">data_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>  <span class="c1"># reserved</span>
                <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context_table</span><span class="p">[</span><span class="n">context_type</span><span class="p">]</span>
                <span class="n">ctx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">negotiate_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NegotiateRequestContext</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_length</span> <span class="o">=</span> <span class="kc">None</span>


<span class="nd">@NegotiateResponse</span><span class="o">.</span><span class="n">negotiate_context</span>
<span class="k">class</span> <span class="nc">NegotiateResponseContext</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PreauthIntegrityCapabilities</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="n">context_type</span> <span class="o">=</span> <span class="n">SMB2_PREAUTH_INTEGRITY_CAPABILITIES</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salt</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salt_length</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms_count</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">salt_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_length</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salt_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithm_count</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hash_algorithms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HashAlgorithms</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salt</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_length</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PreauthIntegrityCapabilitiesRequest</span><span class="p">(</span>
    <span class="n">NegotiateRequestContext</span><span class="p">,</span> <span class="n">PreauthIntegrityCapabilities</span>
<span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">NegotiateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">PreauthIntegrityCapabilities</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PreauthIntegrityCapabilitiesResponse</span><span class="p">(</span>
    <span class="n">NegotiateResponseContext</span><span class="p">,</span> <span class="n">PreauthIntegrityCapabilities</span>
<span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">NegotiateResponseContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">PreauthIntegrityCapabilities</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="c1"># Session setup constants</span>
<div class="viewcode-block" id="SessionFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.SessionFlags">[docs]</a><span class="k">class</span> <span class="nc">SessionFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_SESSION_FLAG_NONE</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">SMB2_SESSION_FLAG_BINDING</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">SMB2_SESSION_FLAG_IS_NULL</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">SMB2_SESSION_FLAG_ENCRYPT_DATA</span> <span class="o">=</span> <span class="mh">0x04</span></div>


<span class="n">SessionFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># SMB2_ECHO_REQUEST definition</span>
<span class="k">class</span> <span class="nc">EchoRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_ECHO</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">)</span>


<span class="c1"># SMB2_ECHO_RESPONSE definition</span>
<span class="k">class</span> <span class="nc">EchoResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="c1"># Expect response whenever SMB2_ECHO_REQUEST sent</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_ECHO</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>


<span class="c1"># SMB2_FLUSH_REQUEST definition</span>
<span class="k">class</span> <span class="nc">FlushRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_FLUSH</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">24</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved1</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved1</span><span class="p">)</span>
        <span class="c1"># Reserved2</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="c1"># SMB2_FLUSH_RESPONSE definition</span>
<span class="k">class</span> <span class="nc">FlushResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="c1"># Expect response whenever SMB2_FLUSH_REQUEST sent</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_FLUSH</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SessionSetupRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_SESSION_SETUP</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">25</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># must not be used</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_session_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_length</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
        <span class="c1"># Encode 0 for security buffer offset for now</span>
        <span class="n">sec_buf_ofs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_buffer</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_length</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">previous_session_id</span><span class="p">)</span>
        <span class="c1"># Go back and set security buffer offset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_offset</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span>
        <span class="n">sec_buf_ofs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_buffer_offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_buffer</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SessionSetupResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_SESSION_SETUP</span>
    <span class="n">allowed_status</span> <span class="o">=</span> <span class="p">[</span><span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_SUCCESS</span><span class="p">,</span> <span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_MORE_PROCESSING_REQUIRED</span><span class="p">]</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_flags</span> <span class="o">=</span> <span class="n">SessionFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>

        <span class="c1"># Advance to sec buffer</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_buffer</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TreeConnectRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_TREE_CONNECT</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">TreeConnectRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved/Flags (SMB 3.1.1)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="c1"># Path Offset</span>
        <span class="n">path_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Path Length</span>
        <span class="n">path_lenght_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_offset</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span>
        <span class="n">path_offset_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_offset</span><span class="p">)</span>

        <span class="n">path_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Path</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_length</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">path_start</span>
        <span class="n">path_lenght_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_length</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TreeConnectResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_TREE_CONNECT</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">16</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">share_type</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">share_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximal_access</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">TreeConnectResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">share_flags</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">share_flags</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">share_type</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="c1"># Ignore reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">share_flags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximal_access</span> <span class="o">=</span> <span class="n">Access</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">TreeDisconnectRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_TREE_DISCONNECT</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TreeDisconnectResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_TREE_DISCONNECT</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Ignore reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">LogoffRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_LOGOFF</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LogoffResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_LOGOFF</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Ignore reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>


<span class="c1"># Oplock levels</span>
<div class="viewcode-block" id="OplockLevel"><a class="viewcode-back" href="../../model.html#pike.smb2.OplockLevel">[docs]</a><span class="k">class</span> <span class="nc">OplockLevel</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">SMB2_OPLOCK_LEVEL_NONE</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">SMB2_OPLOCK_LEVEL_II</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">SMB2_OPLOCK_LEVEL_EXCLUSIVE</span> <span class="o">=</span> <span class="mh">0x08</span>
    <span class="n">SMB2_OPLOCK_LEVEL_BATCH</span> <span class="o">=</span> <span class="mh">0x09</span>
    <span class="n">SMB2_OPLOCK_LEVEL_LEASE</span> <span class="o">=</span> <span class="mh">0xFF</span></div>


<span class="n">OplockLevel</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Share access</span>
<div class="viewcode-block" id="ShareAccess"><a class="viewcode-back" href="../../model.html#pike.smb2.ShareAccess">[docs]</a><span class="k">class</span> <span class="nc">ShareAccess</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">FILE_SHARE_READ</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_SHARE_WRITE</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_SHARE_DELETE</span> <span class="o">=</span> <span class="mh">0x00000004</span></div>


<span class="n">ShareAccess</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>

<span class="n">FILE_SHARE_ALL</span> <span class="o">=</span> <span class="n">FILE_SHARE_READ</span> <span class="o">|</span> <span class="n">FILE_SHARE_WRITE</span> <span class="o">|</span> <span class="n">FILE_SHARE_DELETE</span>


<span class="c1"># Create dispositions</span>
<div class="viewcode-block" id="CreateDisposition"><a class="viewcode-back" href="../../model.html#pike.smb2.CreateDisposition">[docs]</a><span class="k">class</span> <span class="nc">CreateDisposition</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">FILE_SUPERSEDE</span> <span class="o">=</span> <span class="mh">0x00000000</span>
    <span class="n">FILE_OPEN</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_CREATE</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_OPEN_IF</span> <span class="o">=</span> <span class="mh">0x00000003</span>
    <span class="n">FILE_OVERWRITE</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">FILE_OVERWRITE_IF</span> <span class="o">=</span> <span class="mh">0x00000005</span></div>


<span class="n">CreateDisposition</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Create options</span>
<div class="viewcode-block" id="CreateOptions"><a class="viewcode-back" href="../../model.html#pike.smb2.CreateOptions">[docs]</a><span class="k">class</span> <span class="nc">CreateOptions</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">FILE_DIRECTORY_FILE</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_WRITE_THROUGH</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_SEQUENTIAL_ONLY</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">FILE_NO_INTERMEDIATE_BUFFERING</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">FILE_SYNCHRONOUS_IO_ALERT</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">FILE_SYNCRHONOUS_IO_NONALERT</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">FILE_NON_DIRECTORY_FILE</span> <span class="o">=</span> <span class="mh">0x00000040</span>
    <span class="n">FILE_COMPLETE_IF_OPLOCKED</span> <span class="o">=</span> <span class="mh">0x00000100</span>
    <span class="n">FILE_NO_EA_KNOWLEDGE</span> <span class="o">=</span> <span class="mh">0x00000200</span>
    <span class="n">FILE_RANDOM_ACCESS</span> <span class="o">=</span> <span class="mh">0x00000800</span>
    <span class="n">FILE_DELETE_ON_CLOSE</span> <span class="o">=</span> <span class="mh">0x00001000</span>
    <span class="n">FILE_OPEN_BY_FILE_ID</span> <span class="o">=</span> <span class="mh">0x00002000</span>
    <span class="n">FILE_OPEN_FOR_BACKUP_INTENT</span> <span class="o">=</span> <span class="mh">0x00004000</span>
    <span class="n">FILE_NO_COMPRESSION</span> <span class="o">=</span> <span class="mh">0x00008000</span>
    <span class="n">FILE_RESERVE_OPFILTER</span> <span class="o">=</span> <span class="mh">0x00100000</span>
    <span class="n">FILE_OPEN_REPARSE_POINT</span> <span class="o">=</span> <span class="mh">0x00200000</span>
    <span class="n">FILE_OPEN_NO_RECALL</span> <span class="o">=</span> <span class="mh">0x00400000</span>
    <span class="n">FILE_OPEN_FOR_FREE_SPACE_QUERY</span> <span class="o">=</span> <span class="mh">0x00800000</span></div>


<span class="n">CreateOptions</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Access masks</span>
<div class="viewcode-block" id="Access"><a class="viewcode-back" href="../../model.html#pike.smb2.Access">[docs]</a><span class="k">class</span> <span class="nc">Access</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">FILE_READ_DATA</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_WRITE_DATA</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_APPEND_DATA</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">FILE_READ_EA</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">FILE_WRITE_EA</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">FILE_EXECUTE</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">FILE_READ_ATTRIBUTES</span> <span class="o">=</span> <span class="mh">0x00000080</span>
    <span class="n">FILE_WRITE_ATTRIBUTES</span> <span class="o">=</span> <span class="mh">0x00000100</span>
    <span class="n">DELETE</span> <span class="o">=</span> <span class="mh">0x00010000</span>
    <span class="n">READ_CONTROL</span> <span class="o">=</span> <span class="mh">0x00020000</span>
    <span class="n">WRITE_DAC</span> <span class="o">=</span> <span class="mh">0x00040000</span>
    <span class="n">WRITE_OWNER</span> <span class="o">=</span> <span class="mh">0x00080000</span>
    <span class="n">SYNCHRONIZE</span> <span class="o">=</span> <span class="mh">0x00100000</span>
    <span class="n">ACCESS_SYSTEM_SECURITY</span> <span class="o">=</span> <span class="mh">0x01000000</span>
    <span class="n">MAXIMUM_ALLOWED</span> <span class="o">=</span> <span class="mh">0x02000000</span>
    <span class="n">GENERIC_ALL</span> <span class="o">=</span> <span class="mh">0x10000000</span>
    <span class="n">GENERIC_EXECUTE</span> <span class="o">=</span> <span class="mh">0x20000000</span>
    <span class="n">GENERIC_WRITE</span> <span class="o">=</span> <span class="mh">0x40000000</span>
    <span class="n">GENERIC_READ</span> <span class="o">=</span> <span class="mh">0x80000000</span>
    <span class="n">FILE_LIST_DIRECTORY</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_ADD_FILE</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_ADD_SUBDIRECTORY</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">FILE_TRAVERSE</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">FILE_DELETE_CHILD</span> <span class="o">=</span> <span class="mh">0x00000040</span></div>


<span class="n">Access</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># File attributes</span>
<div class="viewcode-block" id="FileAttributes"><a class="viewcode-back" href="../../model.html#pike.smb2.FileAttributes">[docs]</a><span class="k">class</span> <span class="nc">FileAttributes</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">FILE_ATTRIBUTE_READONLY</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_ATTRIBUTE_HIDDEN</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_ATTRIBUTE_SYSTEM</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">FILE_ATTRIBUTE_DIRECTORY</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">FILE_ATTRIBUTE_ARCHIVE</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">FILE_ATTRIBUTE_DEVICE</span> <span class="o">=</span> <span class="mh">0x00000040</span>
    <span class="n">FILE_ATTRIBUTE_NORMAL</span> <span class="o">=</span> <span class="mh">0x00000080</span>
    <span class="n">FILE_ATTRIBUTE_TEMPORARY</span> <span class="o">=</span> <span class="mh">0x00000100</span>
    <span class="n">FILE_ATTRIBUTE_SPARSE_FILE</span> <span class="o">=</span> <span class="mh">0x00000200</span>
    <span class="n">FILE_ATTRIBUTE_REPARSE_POINT</span> <span class="o">=</span> <span class="mh">0x00000400</span>
    <span class="n">FILE_ATTRIBUTE_COMPRESSED</span> <span class="o">=</span> <span class="mh">0x00000800</span>
    <span class="n">FILE_ATTRIBUTE_OFFLINE</span> <span class="o">=</span> <span class="mh">0x00001000</span>
    <span class="n">FILE_ATTRIBUTE_NOT_CONTENT_INDEXED</span> <span class="o">=</span> <span class="mh">0x00002000</span>
    <span class="n">FILE_ATTRIBUTE_ENCRYPTED</span> <span class="o">=</span> <span class="mh">0x00004000</span></div>


<span class="n">FileAttributes</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">CreateRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_CREATE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">57</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requested_oplock_level</span> <span class="o">=</span> <span class="n">SMB2_OPLOCK_LEVEL_NONE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impersonation_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smb_create_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desired_access</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">share_access</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_disposition</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_options</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">super</span><span class="p">(</span><span class="n">CreateRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,])</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># SecurityFlags, must be 0</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_flags</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requested_oplock_level</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">impersonation_level</span><span class="p">)</span>
        <span class="c1"># SmbCreateFlags, must be 0</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smb_create_flags</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desired_access</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">share_access</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_disposition</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_options</span><span class="p">)</span>

        <span class="n">name_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">name_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">create_contexts_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">create_contexts_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">buffer_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_offset</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span>
        <span class="n">name_offset_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_offset</span><span class="p">)</span>

        <span class="n">name_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_length</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">name_start</span>
        <span class="n">name_length_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_length</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Next field of previous context to fill in</span>
            <span class="n">next_hole</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Pointer to start of previous context</span>
            <span class="n">con_start</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">create_contexts_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">create_contexts_offset_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">next_hole</span><span class="p">:</span>
                    <span class="n">next_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">con_start</span><span class="p">)</span>
                <span class="n">con_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">next_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">name_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="c1"># Reserved</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">data_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">data_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="c1"># Name</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">name_offset_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">con_start</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">name_end</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># Data</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">data_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">con</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
                <span class="n">data_length</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">data_start</span>
                <span class="k">if</span> <span class="n">data_length</span><span class="p">:</span>
                    <span class="n">data_offset_hole</span><span class="p">(</span><span class="n">data_start</span> <span class="o">-</span> <span class="n">con_start</span><span class="p">)</span>
                    <span class="n">data_length_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">data_start</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Undo align</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">reverseto</span><span class="p">(</span><span class="n">name_end</span><span class="p">)</span>

            <span class="n">create_contexts_length_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">create_contexts_start</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cur</span> <span class="o">==</span> <span class="n">buffer_start</span><span class="p">:</span>
            <span class="c1"># Buffer must be at least 1 byte</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CreateResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_CREATE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">89</span>

    <span class="n">_context_table</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">create_context</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_context_table</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_action</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">CreateResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
                <span class="s2">&quot;(0x</span><span class="si">{:x}</span><span class="s2">, 0x</span><span class="si">{:x}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span> <span class="o">=</span> <span class="n">OplockLevel</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_action</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="c1"># Ignore Reserved2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">(),</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">create_contexts_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_offset</span>
            <span class="n">create_contexts_end</span> <span class="o">=</span> <span class="n">create_contexts_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_contexts_length</span>
            <span class="n">next_cur</span> <span class="o">=</span> <span class="n">create_contexts_start</span>

            <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">create_contexts_start</span><span class="p">,</span> <span class="n">create_contexts_end</span><span class="p">):</span>
                <span class="k">while</span> <span class="n">next_cur</span><span class="p">:</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">seekto</span><span class="p">(</span><span class="n">next_cur</span><span class="p">)</span>
                    <span class="n">con_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="n">next_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
                    <span class="n">name_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
                    <span class="n">name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
                    <span class="c1"># Ignore Reserved</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
                    <span class="n">data_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
                    <span class="n">data_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

                    <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">con_start</span> <span class="o">+</span> <span class="n">name_offset</span><span class="p">)</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="n">name_length</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

                    <span class="n">cur</span><span class="o">.</span><span class="n">seekto</span><span class="p">(</span><span class="n">con_start</span> <span class="o">+</span> <span class="n">data_offset</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">cur</span> <span class="o">+</span> <span class="n">data_length</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_context_table</span><span class="p">[</span><span class="n">name</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>

                    <span class="n">next_cur</span> <span class="o">=</span> <span class="n">con_start</span> <span class="o">+</span> <span class="n">next_offset</span> <span class="k">if</span> <span class="n">next_offset</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="c1"># Make sure we end up at the end regardless of how much we jumped around</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="n">create_contexts_end</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_contexts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CreateRequestContext</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="nd">@CreateResponse</span><span class="o">.</span><span class="n">create_context</span>
<span class="k">class</span> <span class="nc">CreateResponseContext</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MaximalAccessRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;MxAc&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MaximalAccessResponse</span><span class="p">(</span><span class="n">CreateResponseContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;MxAc&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateResponseContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_status</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximal_access</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_status</span> <span class="o">=</span> <span class="n">ntstatus</span><span class="o">.</span><span class="n">Status</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximal_access</span> <span class="o">=</span> <span class="n">Access</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">AllocationSizeRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;AlSi&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ExtendedAttributeRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;ExtA&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_entry_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mh">0x00000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_name_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_value_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_entry_offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ea_name</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ea_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">00</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ea_value</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ea_value</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_name_length</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_value_length</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_name</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ea_value</span><span class="p">)</span>


<div class="viewcode-block" id="LeaseState"><a class="viewcode-back" href="../../model.html#pike.smb2.LeaseState">[docs]</a><span class="k">class</span> <span class="nc">LeaseState</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_LEASE_NONE</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">SMB2_LEASE_READ_CACHING</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">SMB2_LEASE_HANDLE_CACHING</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">SMB2_LEASE_WRITE_CACHING</span> <span class="o">=</span> <span class="mh">0x04</span></div>


<span class="n">LeaseState</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>

<span class="n">SMB2_LEASE_R</span> <span class="o">=</span> <span class="n">SMB2_LEASE_READ_CACHING</span>
<span class="n">SMB2_LEASE_RH</span> <span class="o">=</span> <span class="n">SMB2_LEASE_R</span> <span class="o">|</span> <span class="n">SMB2_LEASE_HANDLE_CACHING</span>
<span class="n">SMB2_LEASE_RW</span> <span class="o">=</span> <span class="n">SMB2_LEASE_R</span> <span class="o">|</span> <span class="n">SMB2_LEASE_WRITE_CACHING</span>
<span class="n">SMB2_LEASE_RWH</span> <span class="o">=</span> <span class="n">SMB2_LEASE_RH</span> <span class="o">|</span> <span class="n">SMB2_LEASE_RW</span>


<div class="viewcode-block" id="LeaseFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.LeaseFlags">[docs]</a><span class="k">class</span> <span class="nc">LeaseFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_LEASE_FLAG_NONE</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">SMB2_LEASE_FLAG_BREAK_IN_PROGRESS</span> <span class="o">=</span> <span class="mh">0x02</span></div>


<span class="n">LeaseFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="SecDescControl"><a class="viewcode-back" href="../../model.html#pike.smb2.SecDescControl">[docs]</a><span class="k">class</span> <span class="nc">SecDescControl</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SR</span> <span class="o">=</span> <span class="mh">0x0001</span>
    <span class="n">RM</span> <span class="o">=</span> <span class="mh">0x0002</span>
    <span class="n">PS</span> <span class="o">=</span> <span class="mh">0x0004</span>
    <span class="n">PD</span> <span class="o">=</span> <span class="mh">0x0008</span>
    <span class="n">SI</span> <span class="o">=</span> <span class="mh">0x0010</span>
    <span class="n">DI</span> <span class="o">=</span> <span class="mh">0x0020</span>
    <span class="n">SC</span> <span class="o">=</span> <span class="mh">0x0040</span>
    <span class="n">DC</span> <span class="o">=</span> <span class="mh">0x0080</span>
    <span class="n">SS</span> <span class="o">=</span> <span class="mh">0x0100</span>
    <span class="n">DT</span> <span class="o">=</span> <span class="mh">0x0200</span>
    <span class="n">SD</span> <span class="o">=</span> <span class="mh">0x0400</span>
    <span class="n">SP</span> <span class="o">=</span> <span class="mh">0x0800</span>
    <span class="n">DD</span> <span class="o">=</span> <span class="mh">0x1000</span>
    <span class="n">DP</span> <span class="o">=</span> <span class="mh">0x2000</span>
    <span class="n">GD</span> <span class="o">=</span> <span class="mh">0x4000</span>
    <span class="n">OD</span> <span class="o">=</span> <span class="mh">0x8000</span></div>


<div class="viewcode-block" id="AceType"><a class="viewcode-back" href="../../model.html#pike.smb2.AceType">[docs]</a><span class="k">class</span> <span class="nc">AceType</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">ACCESS_ALLOWED_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">ACCESS_DENIED_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">SYSTEM_AUDIT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">SYSTEM_ALARM_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x03</span>
    <span class="n">ACCESS_ALLOWED_COMPOUND_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x04</span>
    <span class="n">ACCESS_ALLOWED_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x05</span>
    <span class="n">ACCESS_DENIED_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x06</span>
    <span class="n">SYSTEM_AUDIT_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x07</span>
    <span class="n">SYSTEM_ALARM_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x08</span>
    <span class="n">ACCESS_ALLOWED_CALLBACK_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x09</span>
    <span class="n">ACCESS_DENIED_CALLBACK_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x0A</span>
    <span class="n">ACCESS_ALLOWED_CALLBACK_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x0B</span>
    <span class="n">ACCESS_DENIED_CALLBACK_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x0C</span>
    <span class="n">SYSTEM_AUDIT_CALLBACK_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x0D</span>
    <span class="n">SYSTEM_ALARM_CALLBACK_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x0E</span>
    <span class="n">SYSTEM_AUDIT_CALLBACK_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x0F</span>
    <span class="n">SYSTEM_ALARM_CALLBACK_OBJECT_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x10</span>
    <span class="n">SYSTEM_MANDATORY_LABEL_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x11</span>
    <span class="n">SYSTEM_RESOURCE_ATTRIBUTE_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x12</span>
    <span class="n">SYSTEM_SCOPED_POLICY_ID_ACE_TYPE</span> <span class="o">=</span> <span class="mh">0x13</span></div>


<span class="n">AceType</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="AceFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.AceFlags">[docs]</a><span class="k">class</span> <span class="nc">AceFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">OBJECT_INHERIT_ACE</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">CONTAINER_INHERIT_ACE</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">NO_PROPAGATE_INHERIT_ACE</span> <span class="o">=</span> <span class="mh">0x04</span>
    <span class="n">INHERIT_ONLY_ACE</span> <span class="o">=</span> <span class="mh">0x08</span>
    <span class="n">INHERITED_ACE</span> <span class="o">=</span> <span class="mh">0x10</span>
    <span class="n">SUCCESSFUL_ACCESS_ACE_FLAG</span> <span class="o">=</span> <span class="mh">0x40</span>
    <span class="n">FAILED_ACCESS_ACE_FLAG</span> <span class="o">=</span> <span class="mh">0x80</span></div>


<span class="n">AceFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="AclRevision"><a class="viewcode-back" href="../../model.html#pike.smb2.AclRevision">[docs]</a><span class="k">class</span> <span class="nc">AclRevision</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">ACL_REVISION</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">ACL_REVISION_DS</span> <span class="o">=</span> <span class="mh">0x04</span></div>


<span class="n">AclRevision</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">SecurityDescriptorRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;SecD&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbz1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sacl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dacl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sacl_aces</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dacl_aces</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset</span><span class="p">(</span>
            <span class="n">owner_sid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span><span class="p">,</span>
            <span class="n">group_sid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span><span class="p">,</span>
            <span class="n">sacl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sacl_aces</span><span class="p">,</span>
            <span class="n">dacl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dacl_aces</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sbz1</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_encode_sid</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_encode_sid</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Acl Revision</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sacl</span><span class="p">)</span>
            <span class="c1"># sbz1</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Acl Size</span>
            <span class="n">sid_size</span><span class="p">,</span> <span class="n">ace_size</span><span class="p">,</span> <span class="n">acl_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">acl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sacl_aces</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">acl_size</span><span class="p">)</span>
            <span class="c1"># Ace Count</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sacl_aces</span><span class="p">))</span>
            <span class="c1"># sbz2</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sacl_aces</span><span class="p">:</span>
                <span class="c1"># Ace Type</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># Ace flags</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># Ace Size</span>
                <span class="n">sid_size</span><span class="p">,</span> <span class="n">ace_size</span><span class="p">,</span> <span class="n">acl_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">ace_val</span><span class="o">=</span><span class="n">ace</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">ace_size</span><span class="p">)</span>
                <span class="c1"># Ace Mask</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sid</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_encode_sid</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Acl Revision</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dacl</span><span class="p">)</span>
            <span class="c1"># sbz1</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Acl Size</span>
            <span class="n">sid_size</span><span class="p">,</span> <span class="n">ace_size</span><span class="p">,</span> <span class="n">acl_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">acl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dacl_aces</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">acl_size</span><span class="p">)</span>
            <span class="c1"># Ace Count</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dacl_aces</span><span class="p">))</span>
            <span class="c1"># sbz2</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dacl_aces</span><span class="p">:</span>
                <span class="c1"># Ace Type</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1"># Ace flags</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1"># Ace Size</span>
                <span class="n">sid_size</span><span class="p">,</span> <span class="n">ace_size</span><span class="p">,</span> <span class="n">acl_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">ace_val</span><span class="o">=</span><span class="n">ace</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">ace_size</span><span class="p">)</span>
                <span class="c1"># Ace Mask</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sid</span><span class="p">(</span><span class="n">ace</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_encode_sid</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode_sid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span><span class="p">):</span>
        <span class="n">sub_auth</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sub_auth</span><span class="p">]</span>
        <span class="c1"># Revision</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span>
        <span class="c1"># Sub Authrty Count</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub_auth</span><span class="p">))</span>
        <span class="c1"># Identifier Authority</span>
        <span class="n">tmp_id_auth</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">])</span>
        <span class="n">tmp_id_auth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">id_auth</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">tmp</span> <span class="ow">in</span> <span class="n">tmp_id_auth</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="c1"># Sub Authority</span>
        <span class="k">for</span> <span class="n">tmp_sub_auth</span> <span class="ow">in</span> <span class="n">sub_auth</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="n">tmp_sub_auth</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_sid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
        <span class="n">pat</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;S-1-(\d)-(.*)&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span> <span class="n">sid</span><span class="p">)</span>
        <span class="n">id_auth</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">sub_auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span>

    <span class="k">def</span> <span class="nf">_get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ace_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">acl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">sid_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ace_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">acl_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># All Sizes are in Bytes</span>
        <span class="n">sbz1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">sbz2</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">revision_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ace_type_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ace_flags_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ace_size_param</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ace_mask_size</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">acl_revision_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">acl_size_param</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">ace_count_size</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">sub_auth_count_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">identifier_auth_size</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">sub_auth_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">sid</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sid</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
            <span class="n">sub_auth_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_auth</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="n">sid_size</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">revision_size</span>
                <span class="o">+</span> <span class="n">sub_auth_count_size</span>
                <span class="o">+</span> <span class="n">identifier_auth_size</span>
                <span class="o">+</span> <span class="n">sub_auth_size</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">ace_val</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sub_auth_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sid</span><span class="p">(</span><span class="n">ace_val</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">sub_auth_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_auth</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="n">sid_size</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">revision_size</span>
                <span class="o">+</span> <span class="n">sub_auth_count_size</span>
                <span class="o">+</span> <span class="n">identifier_auth_size</span>
                <span class="o">+</span> <span class="n">sub_auth_size</span>
            <span class="p">)</span>
            <span class="n">ace_size</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ace_type_size</span>
                <span class="o">+</span> <span class="n">ace_flags_size</span>
                <span class="o">+</span> <span class="n">ace_size_param</span>
                <span class="o">+</span> <span class="n">ace_mask_size</span>
                <span class="o">+</span> <span class="n">sid_size</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">acl</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_acl_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">aces</span> <span class="ow">in</span> <span class="n">acl</span><span class="p">:</span>
                <span class="n">sub_auth_size</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">id_auth</span><span class="p">,</span> <span class="n">sub_auth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sid</span><span class="p">(</span><span class="n">aces</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">sub_auth_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub_auth</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
                <span class="n">sid_size</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">revision_size</span>
                    <span class="o">+</span> <span class="n">sub_auth_count_size</span>
                    <span class="o">+</span> <span class="n">identifier_auth_size</span>
                    <span class="o">+</span> <span class="n">sub_auth_size</span>
                <span class="p">)</span>
                <span class="n">ace_size</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ace_type_size</span>
                    <span class="o">+</span> <span class="n">ace_flags_size</span>
                    <span class="o">+</span> <span class="n">ace_size_param</span>
                    <span class="o">+</span> <span class="n">ace_mask_size</span>
                    <span class="o">+</span> <span class="n">sid_size</span>
                <span class="p">)</span>
                <span class="n">tmp_acl_size</span> <span class="o">+=</span> <span class="n">ace_size</span>
                <span class="n">acl_size</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">acl_revision_size</span>
                    <span class="o">+</span> <span class="n">sbz1</span>
                    <span class="o">+</span> <span class="n">acl_size_param</span>
                    <span class="o">+</span> <span class="n">ace_count_size</span>
                    <span class="o">+</span> <span class="n">sbz2</span>
                    <span class="o">+</span> <span class="n">tmp_acl_size</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">sid_size</span><span class="p">,</span> <span class="n">ace_size</span><span class="p">,</span> <span class="n">acl_size</span>

    <span class="k">def</span> <span class="nf">_get_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner_sid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_sid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sacl</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dacl</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">default_offset</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">owner_sid_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">sid</span><span class="o">=</span><span class="n">owner_sid</span><span class="p">)</span>
        <span class="n">off_owner</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">owner_sid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">default_offset</span>
        <span class="n">group_sid_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">sid</span><span class="o">=</span><span class="n">group_sid</span><span class="p">)</span>
        <span class="n">off_group</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">group_sid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">default_offset</span> <span class="o">+</span> <span class="n">owner_sid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sacl_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">acl</span><span class="o">=</span><span class="n">sacl</span><span class="p">)</span>
        <span class="n">off_sacl</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">0</span>
            <span class="k">if</span> <span class="n">sacl_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="n">default_offset</span> <span class="o">+</span> <span class="n">owner_sid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">group_sid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">dacl_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_size</span><span class="p">(</span><span class="n">acl</span><span class="o">=</span><span class="n">dacl</span><span class="p">)</span>
        <span class="n">off_dacl</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">0</span>
            <span class="k">if</span> <span class="n">dacl_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="n">default_offset</span> <span class="o">+</span> <span class="n">owner_sid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">group_sid_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">sacl_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">off_owner</span><span class="p">,</span> <span class="n">off_group</span><span class="p">,</span> <span class="n">off_sacl</span><span class="p">,</span> <span class="n">off_dacl</span>


<span class="k">class</span> <span class="nc">NT_ACL</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NT_ACL</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl_revision</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbz1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl_size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbz2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a copy of this NT_ACL with calculated fields reset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">acl</span> <span class="o">=</span> <span class="n">NT_ACL</span><span class="p">()</span>
        <span class="n">acl</span><span class="o">.</span><span class="n">acl_revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acl_revision</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">:</span>
            <span class="n">acl</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ace</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">ace</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">new_parent</span><span class="o">=</span><span class="n">acl</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">acl</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        decode the ACL</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl_revision</span> <span class="o">=</span> <span class="n">AclRevision</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbz1</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acl_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbz2</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ace_count</span><span class="p">):</span>
            <span class="n">NT_ACE</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="n">acl_remain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">acl_size</span> <span class="o">-</span> <span class="n">cur</span>
        <span class="k">assert</span> <span class="n">acl_remain</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">acl_remain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="n">acl_remain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        encode the acl</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acl_revision</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># hole for acl_size and acl_count</span>
        <span class="n">acl_size_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">acl_count_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
            <span class="n">entry</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">):</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acl_size</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">acl_size</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="n">acl_size_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acl_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ace_count</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ace_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">)</span>
        <span class="n">acl_count_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ace_count</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NT_ACE</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NT_ACE</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_type</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_mask</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a copy of this NT_ACE with calculated fields reset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ace</span> <span class="o">=</span> <span class="n">NT_ACE</span><span class="p">(</span><span class="n">new_parent</span><span class="p">)</span>
        <span class="n">ace</span><span class="o">.</span><span class="n">ace_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ace_type</span>
        <span class="n">ace</span><span class="o">.</span><span class="n">ace_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ace_flags</span>
        <span class="n">ace</span><span class="o">.</span><span class="n">access_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_mask</span>
        <span class="n">ace</span><span class="o">.</span><span class="n">sid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sid</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">:</span>
            <span class="n">ace</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ace</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        decode the ACE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_type</span> <span class="o">=</span> <span class="n">AceType</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_flags</span> <span class="o">=</span> <span class="n">AceFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ace_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_mask</span> <span class="o">=</span> <span class="n">Access</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sid</span> <span class="o">=</span> <span class="n">NT_SID</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="c1"># check if we reach the end</span>
        <span class="n">ace_remain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ace_size</span> <span class="o">-</span> <span class="n">cur</span>
        <span class="k">assert</span> <span class="n">ace_remain</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">ace_remain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="n">ace_remain</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        encode the ace</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ace_type</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ace_flags</span><span class="p">)</span>
        <span class="c1"># hole for ace size</span>
        <span class="n">ace_size_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access_mask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sid</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">):</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ace_size</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ace_size</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="n">ace_size_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ace_size</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NT_SID</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NT_SID</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority_count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier_authority</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a copy of this NT_SID with calculated fields reset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">NT_SID</span><span class="p">()</span>
        <span class="n">sid</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">revision</span>
        <span class="n">sid</span><span class="o">.</span><span class="n">identifier_authority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier_authority</span>
        <span class="n">sid</span><span class="o">.</span><span class="n">sub_authority</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">:</span>
            <span class="n">sid</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sid</span>

    <span class="k">def</span> <span class="nf">_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indent</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">string</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sid_str</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;S-&quot;</span>
            <span class="o">+</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier_authority</span><span class="p">))</span>
            <span class="o">+</span> <span class="s2">&quot;-&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">sid_str</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        decode the raw data to the specified end of buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="n">id_auth_high</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16be</span><span class="p">()</span>
        <span class="n">id_auth_low</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32be</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier_authority</span> <span class="o">=</span> <span class="p">(</span><span class="n">id_auth_high</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">id_auth_low</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_authority_count</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        encode the sid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision</span><span class="p">)</span>
        <span class="n">subauth_count_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">auth_bytes</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:06x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier_authority</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16be</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier_authority</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32be</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier_authority</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFF</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_authority</span><span class="p">)):</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_authority</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority_count</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sub_authority_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_authority</span><span class="p">)</span>
        <span class="n">subauth_count_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_authority_count</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LeaseRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;RqLs&quot;</span>

    <span class="c1"># This class handles V2 requests as well.  Set</span>
    <span class="c1"># the lease_flags field to a non-None value</span>
    <span class="c1"># to enable the extended fields</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># V2 fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_flags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_lease_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lease_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># V2 variant</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lease_flags</span><span class="p">)</span>
            <span class="c1"># LeaseDuration is reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent_lease_key</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">)</span>
            <span class="c1"># Reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Regular variant</span>
            <span class="c1"># LeaseFlags is reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># LeaseDuration is reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">LeaseResponse</span><span class="p">(</span><span class="n">CreateResponseContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;RqLs&quot;</span>
    <span class="n">v1_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">v2_size</span> <span class="o">=</span> <span class="mi">52</span>
    <span class="c1"># This class handles V2 responses as well.</span>
    <span class="c1"># The extended fields will be set to None</span>
    <span class="c1"># if the response was not V2</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateResponseContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_lease_key</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">upperbound</span> <span class="o">-</span> <span class="n">cur</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v1_size</span> <span class="ow">and</span> <span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v2_size</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">core</span><span class="o">.</span><span class="n">BadPacket</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span> <span class="o">=</span> <span class="n">LeaseState</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_flags</span> <span class="o">=</span> <span class="n">LeaseFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="c1"># LeaseDuration is reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">v2_size</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_lease_key</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
            <span class="c1"># Ignore Reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent_lease_key</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="DurableFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.DurableFlags">[docs]</a><span class="k">class</span> <span class="nc">DurableFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_DHANDLE_FLAG_PERSISTENT</span> <span class="o">=</span> <span class="mh">0x02</span></div>


<span class="n">DurableFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">DurableHandleRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;DHnQ&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DurableHandleResponse</span><span class="p">(</span><span class="n">CreateResponseContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;DHnQ&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateResponseContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Ignore reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">DurableHandleReconnectRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;DHnC&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">DurableHandleV2Request</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;DH2Q&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_guid</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_guid</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DurableHandleV2Response</span><span class="p">(</span><span class="n">CreateResponseContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;DH2Q&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateResponseContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">DurableFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">DurableHandleReconnectV2Request</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;DH2C&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_guid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_guid</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AppInstanceIdRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x45\xBC\xA6\x6A\xEF\xA7\xF7\x4A\x90\x08\xFA\x46\x2E\x14\x4D\x74</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structure_size</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_instance_id</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure_size</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_instance_id</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">QueryOnDiskIDRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;QFid&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateRequestContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>  <span class="c1"># client sends no data to server</span>


<span class="k">class</span> <span class="nc">QueryOnDiskIDResponse</span><span class="p">(</span><span class="n">CreateResponseContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;QFid&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">CreateResponseContext</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">32</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TimewarpTokenRequest</span><span class="p">(</span><span class="n">CreateRequestContext</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;TWrp&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimewarpTokenRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CloseRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_CLOSE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">24</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">CloseRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
            <span class="s2">&quot;(0x</span><span class="si">{:x}</span><span class="s2">, 0x</span><span class="si">{:x}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<div class="viewcode-block" id="CloseFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.CloseFlags">[docs]</a><span class="k">class</span> <span class="nc">CloseFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_CLOSE_FLAG_POSTQUERY_ATTRIB</span> <span class="o">=</span> <span class="mh">0x0001</span></div>


<span class="n">CloseFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">CloseResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_CLOSE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">60</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">CloseFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>


<div class="viewcode-block" id="FileInformationClass"><a class="viewcode-back" href="../../model.html#pike.smb2.FileInformationClass">[docs]</a><span class="k">class</span> <span class="nc">FileInformationClass</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">FILE_SECURITY_INFORMATION</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">FILE_DIRECTORY_INFORMATION</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">FILE_FULL_DIRECTORY_INFORMATION</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">FILE_BASIC_INFORMATION</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">FILE_STANDARD_INFORMATION</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">FILE_INTERNAL_INFORMATION</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">FILE_EA_INFORMATION</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">FILE_ACCESS_INFORMATION</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">FILE_NAME_INFORMATION</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">FILE_RENAME_INFORMATION</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">FILE_NAMES_INFORMATION</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">FILE_DISPOSITION_INFORMATION</span> <span class="o">=</span> <span class="mi">13</span>
    <span class="n">FILE_POSITION_INFORMATION</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">FILE_MODE_INFORMATION</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">FILE_ALIGNMENT_INFORMATION</span> <span class="o">=</span> <span class="mi">17</span>
    <span class="n">FILE_ALL_INFORMATION</span> <span class="o">=</span> <span class="mi">18</span>
    <span class="n">FILE_ALLOCATION_INFORMATION</span> <span class="o">=</span> <span class="mi">19</span>
    <span class="n">FILE_END_OF_FILE_INFORMATION</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">FILE_STREAM_INFORMATION</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">FILE_COMPRESSION_INFORMATION</span> <span class="o">=</span> <span class="mi">28</span>
    <span class="n">FILE_NETWORK_OPEN_INFORMATION</span> <span class="o">=</span> <span class="mi">34</span>
    <span class="n">FILE_ATTRIBUTE_TAG_INFORMATION</span> <span class="o">=</span> <span class="mi">35</span>
    <span class="n">FILE_ID_BOTH_DIR_INFORMATION</span> <span class="o">=</span> <span class="mi">37</span>
    <span class="n">FILE_ID_FULL_DIR_INFORMATION</span> <span class="o">=</span> <span class="mi">38</span>
    <span class="n">FILE_VALID_DATA_LENGTH_INFORMATION</span> <span class="o">=</span> <span class="mi">39</span></div>


<span class="n">FileInformationClass</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="FileSystemInformationClass"><a class="viewcode-back" href="../../model.html#pike.smb2.FileSystemInformationClass">[docs]</a><span class="k">class</span> <span class="nc">FileSystemInformationClass</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">FILE_FS_VOLUME_INFORMATION</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">FILE_FS_SIZE_INFORMATION</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">FILE_FS_DEVICE_INFORMATION</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">FILE_FS_ATTRIBUTE_INFORMATION</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">FILE_FS_CONTROL_INFORMATION</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">FILE_FS_FULL_SIZE_INFORMATION</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">FILE_FS_OBJECTID_INFORMATION</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">FILE_FS_SECTOR_SIZE_INFORMATION</span> <span class="o">=</span> <span class="mi">11</span></div>


<span class="n">FileSystemInformationClass</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">QueryDirectoryRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_QUERY_DIRECTORY</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">33</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_buffer_length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">QueryDirectoryRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_index</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">file_name_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">file_name_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_buffer_length</span><span class="p">)</span>

        <span class="n">file_name_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">file_name_offset_hole</span><span class="p">(</span><span class="n">file_name_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">file_name_length_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">file_name_start</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">QueryDirectoryResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_QUERY_DIRECTORY</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="n">_file_info_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">file_information</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_file_info_map</span><span class="p">,</span> <span class="s2">&quot;file_information_class&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Try to figure out file information class by looking up</span>
        <span class="c1"># associated request in context</span>
        <span class="n">request</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>

        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_request</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">message_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_information_class</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">QueryDirectoryResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">output_buffer_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="n">output_buffer_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">output_buffer_offset</span><span class="p">)</span>

        <span class="n">end</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">+</span> <span class="n">output_buffer_length</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_info_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span><span class="p">]</span>

            <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                <span class="k">while</span> <span class="n">cur</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<div class="viewcode-block" id="InfoType"><a class="viewcode-back" href="../../model.html#pike.smb2.InfoType">[docs]</a><span class="k">class</span> <span class="nc">InfoType</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">SMB2_0_INFO_FILE</span> <span class="o">=</span> <span class="mh">0x01</span>
    <span class="n">SMB2_0_INFO_FILESYSTEM</span> <span class="o">=</span> <span class="mh">0x02</span>
    <span class="n">SMB2_0_INFO_SECURITY</span> <span class="o">=</span> <span class="mh">0x03</span>
    <span class="n">SMB2_0_INFO_QUOTA</span> <span class="o">=</span> <span class="mh">0x04</span></div>


<span class="n">InfoType</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="SecurityInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.SecurityInformation">[docs]</a><span class="k">class</span> <span class="nc">SecurityInformation</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">OWNER_SECURITY_INFORMATION</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">GROUP_SECURITY_INFORMATION</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">DACL_SECURITY_INFORMATION</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">SACL_SECURITY_INFORMATION</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">ATTRIBUTE_SECURITY_INFORMATION</span> <span class="o">=</span> <span class="mh">0x00000020</span></div>


<span class="n">SecurityInformation</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="ScanFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.ScanFlags">[docs]</a><span class="k">class</span> <span class="nc">ScanFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SL_RESTART_SCAN</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">SL_RETURN_SINGLE_ENTRY</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">SL_INDEX_SPECIFIED</span> <span class="o">=</span> <span class="mh">0x00000004</span></div>


<span class="n">ScanFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">QueryInfoRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_QUERY_INFO</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">41</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_information</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_buffer_length</span> <span class="o">=</span> <span class="mi">4096</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">QueryInfoRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_type</span> <span class="o">==</span> <span class="n">SMB2_0_INFO_FILE</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">:</span>
                <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_type</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_type</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_buffer_length</span><span class="p">)</span>

        <span class="c1"># We&#39;re not implementing the input buffer support right now</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Reserved</span>

        <span class="c1"># We&#39;re not implementing the input buffer support right now</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_information</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">QueryInfoResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_QUERY_INFO</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">allowed_status</span> <span class="o">=</span> <span class="p">[</span><span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_SUCCESS</span><span class="p">,</span> <span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_BUFFER_OVERFLOW</span><span class="p">]</span>
    <span class="n">LOG_CHILDREN_COUNT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">LOG_CHILDREN_EXPAND</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_info_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">information</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_info_map</span><span class="p">,</span> <span class="s2">&quot;info_type&quot;</span><span class="p">,</span> <span class="s2">&quot;file_information_class&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_info_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">get_request</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">message_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info_type</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">info_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_information_class</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">output_buffer_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="n">output_buffer_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">output_buffer_offset</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">+</span> <span class="n">output_buffer_length</span>

        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_info_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_information_class</span><span class="p">)</span>
        <span class="n">info_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">info_cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">info_cls</span> <span class="o">==</span> <span class="n">FileSecurityInformation</span><span class="p">:</span>
                <span class="n">info_cls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                    <span class="k">while</span> <span class="n">cur</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
                        <span class="n">info_cls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SetInfoRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_SET_INFO</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">33</span>
    <span class="n">LOG_CHILDREN_COUNT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">LOG_CHILDREN_EXPAND</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_type</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_buffer_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_buffer_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_information</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_type</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">info_type</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">:</span>
            <span class="c1"># Determine it from child object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_information_class</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info_type</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_information_class</span><span class="p">)</span>

        <span class="n">buffer_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">buffer_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Reserved</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">additional_information</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">buffer_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">buffer_offset_hole</span><span class="p">(</span><span class="n">buffer_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entries</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>

        <span class="n">buffer_length_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">buffer_start</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SetInfoResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_SET_INFO</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># The response is only the structure size</span>
        <span class="k">pass</span>


<div class="viewcode-block" id="Information"><a class="viewcode-back" href="../../model.html#pike.smb2.Information">[docs]</a><span class="k">class</span> <span class="nc">Information</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all info frames. Holds the raw data if no specific decoder</span>
<span class="sd">    has been registered for the given info type</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">info_type</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Information</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        decode the raw data to the specified end of buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">cur</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        encode the raw data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileInformation">[docs]</a><span class="nd">@QueryDirectoryResponse</span><span class="o">.</span><span class="n">file_information</span>
<span class="nd">@QueryInfoResponse</span><span class="o">.</span><span class="n">information</span>
<span class="k">class</span> <span class="nc">FileInformation</span><span class="p">(</span><span class="n">Information</span><span class="p">):</span>
    <span class="n">info_type</span> <span class="o">=</span> <span class="n">SMB2_0_INFO_FILE</span></div>


<div class="viewcode-block" id="FileSystemInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileSystemInformation">[docs]</a><span class="nd">@QueryInfoResponse</span><span class="o">.</span><span class="n">information</span>
<span class="k">class</span> <span class="nc">FileSystemInformation</span><span class="p">(</span><span class="n">Information</span><span class="p">):</span>
    <span class="n">info_type</span> <span class="o">=</span> <span class="n">SMB2_0_INFO_FILESYSTEM</span></div>


<div class="viewcode-block" id="FileSecurityInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileSecurityInformation">[docs]</a><span class="k">class</span> <span class="nc">FileSecurityInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_SECURITY_INFORMATION</span>
    <span class="n">info_type</span> <span class="o">=</span> <span class="n">SMB2_0_INFO_SECURITY</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbz1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sacl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dacl</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_static_clone</span><span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">copy_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        static method implementing both clone and clone_from methods</span>

<span class="sd">        o1 is updated based on the values in o2</span>

<span class="sd">        copy_fields is a list of field names that will be cloned.</span>
<span class="sd">        if copy_fields is None (default), all fields are copied</span>

<span class="sd">        header fields &#39;revision&#39; and &#39;control&#39; are always cloned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o1</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="n">o2</span><span class="o">.</span><span class="n">revision</span>
        <span class="n">o1</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">o2</span><span class="o">.</span><span class="n">control</span>
        <span class="k">if</span> <span class="n">copy_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;other&quot;</span> <span class="ow">in</span> <span class="n">copy_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o2</span><span class="o">.</span><span class="n">other</span><span class="p">:</span>
                <span class="n">o1</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="n">o2</span><span class="o">.</span><span class="n">other</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">copy_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;owner_sid&quot;</span> <span class="ow">in</span> <span class="n">copy_fields</span><span class="p">:</span>
            <span class="n">o1</span><span class="o">.</span><span class="n">owner_sid</span> <span class="o">=</span> <span class="n">o2</span><span class="o">.</span><span class="n">owner_sid</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">copy_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;group_sid&quot;</span> <span class="ow">in</span> <span class="n">copy_fields</span><span class="p">:</span>
            <span class="n">o1</span><span class="o">.</span><span class="n">group_sid</span> <span class="o">=</span> <span class="n">o2</span><span class="o">.</span><span class="n">group_sid</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">copy_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;sacl&quot;</span> <span class="ow">in</span> <span class="n">copy_fields</span><span class="p">:</span>
            <span class="n">o1</span><span class="o">.</span><span class="n">sacl</span> <span class="o">=</span> <span class="n">o2</span><span class="o">.</span><span class="n">sacl</span>
        <span class="k">if</span> <span class="n">copy_fields</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;dacl&quot;</span> <span class="ow">in</span> <span class="n">copy_fields</span><span class="p">:</span>
            <span class="n">o1</span><span class="o">.</span><span class="n">dacl</span> <span class="o">=</span> <span class="n">o2</span><span class="o">.</span><span class="n">dacl</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

<div class="viewcode-block" id="FileSecurityInformation.clone_from"><a class="viewcode-back" href="../../model.html#pike.smb2.FileSecurityInformation.clone_from">[docs]</a>    <span class="k">def</span> <span class="nf">clone_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sec_info</span><span class="p">,</span> <span class="n">copy_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        update the fields in this FileSecurityInformation based on the values</span>
<span class="sd">        of sec_info</span>

<span class="sd">        copy_fields is a list of field names that will be cloned.</span>
<span class="sd">        if copy_fields is None (default), all fields are copied</span>

<span class="sd">        header fields &#39;revision&#39; and &#39;control&#39; are always cloned</span>

<span class="sd">        all calculated fields will be reset and this FileSecurityInformation</span>
<span class="sd">        may be subsequently modified and used to set FileSecurityInformation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">FileSecurityInformation</span><span class="o">.</span><span class="n">_static_clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sec_info</span><span class="p">,</span> <span class="n">copy_fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="FileSecurityInformation.clone"><a class="viewcode-back" href="../../model.html#pike.smb2.FileSecurityInformation.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">copy_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a copy of this FileSecurityInfo with calculated fields reset</span>

<span class="sd">        copy_fields is a list of field names that will be cloned.</span>
<span class="sd">        if copy_fields is None (default), all fields are copied</span>

<span class="sd">        header fields &#39;revision&#39; and &#39;control&#39; are always cloned</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sec_info</span> <span class="o">=</span> <span class="n">FileSecurityInformation</span><span class="p">(</span><span class="n">new_parent</span><span class="p">)</span>
        <span class="n">FileSecurityInformation</span><span class="o">.</span><span class="n">_static_clone</span><span class="p">(</span><span class="n">sec_info</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">copy_fields</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sec_info</span></div>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">revision</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sbz1</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control</span> <span class="o">=</span> <span class="n">SecDescControl</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># find next non-zero offset in list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span> <span class="o">=</span> <span class="n">NT_SID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span> <span class="o">=</span> <span class="n">NT_SID</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sacl_len</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sacl</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="n">sacl_len</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dacl</span> <span class="o">=</span> <span class="n">NT_ACL</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dacl</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">cur</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">revision</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">control</span><span class="p">)</span>
        <span class="c1"># Encode 0 for all the offsets for now</span>
        <span class="n">owner_ofs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">group_ofs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sacl_ofs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">dacl_ofs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="n">owner_ofs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_owner</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner_sid</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="n">group_ofs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_group</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group_sid</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sacl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="n">sacl_ofs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_sacl</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sacl</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dacl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
            <span class="n">dacl_ofs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_dacl</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dacl</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileAccessInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileAccessInformation">[docs]</a><span class="k">class</span> <span class="nc">FileAccessInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_ACCESS_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_flags</span> <span class="o">=</span> <span class="n">Access</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span></div>


<span class="c1"># Alignment Requirement flags</span>
<div class="viewcode-block" id="Alignment"><a class="viewcode-back" href="../../model.html#pike.smb2.Alignment">[docs]</a><span class="k">class</span> <span class="nc">Alignment</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">FILE_BYTE_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x00000000</span>
    <span class="n">FILE_WORD_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_LONG_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x00000003</span>
    <span class="n">FILE_QUAD_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x00000007</span>
    <span class="n">FILE_OCTA_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x0000000F</span>
    <span class="n">FILE_32_BYTE_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x0000001F</span>
    <span class="n">FILE_64_BYTE_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x0000003F</span>
    <span class="n">FILE_128_BYTE_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x0000007F</span>
    <span class="n">FILE_256_BYTE_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x000000FF</span>
    <span class="n">FILE_512_BYTE_ALIGNMENT</span> <span class="o">=</span> <span class="mh">0x000001FF</span></div>


<span class="n">Alignment</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="FileAlignmentInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileAlignmentInformation">[docs]</a><span class="k">class</span> <span class="nc">FileAlignmentInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_ALIGNMENT_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_requirement</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_requirement</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span></div>


<div class="viewcode-block" id="FileAllInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileAllInformation">[docs]</a><span class="k">class</span> <span class="nc">FileAllInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_ALL_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">basic_information</span> <span class="o">=</span> <span class="n">FileBasicInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standard_information</span> <span class="o">=</span> <span class="n">FileStandardInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_information</span> <span class="o">=</span> <span class="n">FileInternalInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_information</span> <span class="o">=</span> <span class="n">FileEaInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_information</span> <span class="o">=</span> <span class="n">FileAccessInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">position_information</span> <span class="o">=</span> <span class="n">FilePositionInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_information</span> <span class="o">=</span> <span class="n">FileModeInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alignment_information</span> <span class="o">=</span> <span class="n">FileAlignmentInformation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_information</span> <span class="o">=</span> <span class="n">FileNameInformation</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
                <span class="n">frame</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileDirectoryInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileDirectoryInformation">[docs]</a><span class="k">class</span> <span class="nc">FileDirectoryInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_DIRECTORY_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">next_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>

        <span class="n">file_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="n">file_name_length</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">next_offset</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">next_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">upperbound</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileFullDirectoryInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFullDirectoryInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFullDirectoryInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FULL_DIRECTORY_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">next_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="n">file_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="n">file_name_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">next_offset</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">next_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">upperbound</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileIdFullDirectoryInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileIdFullDirectoryInformation">[docs]</a><span class="k">class</span> <span class="nc">FileIdFullDirectoryInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_ID_FULL_DIR_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">next_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="n">file_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="n">file_name_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">next_offset</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">next_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">upperbound</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileIdBothDirectoryInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileIdBothDirectoryInformation">[docs]</a><span class="k">class</span> <span class="nc">FileIdBothDirectoryInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_ID_BOTH_DIR_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">next_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name_length</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">next_offset</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">next_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">upperbound</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileBasicInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileBasicInformation">[docs]</a><span class="k">class</span> <span class="nc">FileBasicInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_BASIC_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="c1"># Ignore the 4-byte reserved field</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">change_time</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span><span class="p">)</span>
        <span class="c1"># Ignore the 4-byte reserved field</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileNetworkOpenInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileNetworkOpenInformation">[docs]</a><span class="k">class</span> <span class="nc">FileNetworkOpenInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_NETWORK_OPEN_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_access_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_write_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="c1"># Ignore the 4-byte reserved field</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span></div>


<div class="viewcode-block" id="FileAttributeTagInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileAttributeTagInformation">[docs]</a><span class="k">class</span> <span class="nc">FileAttributeTagInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_ATTRIBUTE_TAG_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reparse_tag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_attributes</span> <span class="o">=</span> <span class="n">FileAttributes</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reparse_tag</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span></div>


<div class="viewcode-block" id="FileStreamInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileStreamInformation">[docs]</a><span class="k">class</span> <span class="nc">FileStreamInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_STREAM_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_entry_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_name_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_entry_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_name_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_entry_offset</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_entry_offset</span><span class="p">)</span></div>


<span class="c1"># Compression Format</span>
<div class="viewcode-block" id="CompressionFormat"><a class="viewcode-back" href="../../model.html#pike.smb2.CompressionFormat">[docs]</a><span class="k">class</span> <span class="nc">CompressionFormat</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">COMPRESSION_FORMAT_NONE</span> <span class="o">=</span> <span class="mh">0x0000</span>
    <span class="n">COMPRESSION_FORMAT_LZNT1</span> <span class="o">=</span> <span class="mh">0x0002</span></div>


<span class="n">CompressionFormat</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="FileCompressionInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileCompressionInformation">[docs]</a><span class="k">class</span> <span class="nc">FileCompressionInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_COMPRESSION_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compressed_file_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression_format</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression_unit_shift</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_shift</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_shift</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compressed_file_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression_format</span> <span class="o">=</span> <span class="n">CompressionFormat</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compression_unit_shift</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_shift</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_shift</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>

        <span class="c1"># This is a single reserved field of 3 bytes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="FileInternalInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileInternalInformation">[docs]</a><span class="k">class</span> <span class="nc">FileInternalInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_INTERNAL_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_number</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_number</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span></div>


<div class="viewcode-block" id="FileModeInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileModeInformation">[docs]</a><span class="k">class</span> <span class="nc">FileModeInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_MODE_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="c1"># See Create options (e.g. FILE_DELETE_ON_CLOSE) for available flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">CreateOptions</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileNameInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileNameInformation">[docs]</a><span class="k">class</span> <span class="nc">FileNameInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_NAME_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">file_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="n">file_name_length</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileRenameInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileRenameInformation">[docs]</a><span class="k">class</span> <span class="nc">FileRenameInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_RENAME_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replace_if_exists</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_directory</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replace_if_exists</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_directory</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_directory</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">file_name_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">file_name_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">file_name_length_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">file_name_start</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileAllocationInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileAllocationInformation">[docs]</a><span class="k">class</span> <span class="nc">FileAllocationInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_ALLOCATION_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_int64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileDispositionInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileDispositionInformation">[docs]</a><span class="k">class</span> <span class="nc">FileDispositionInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_DISPOSITION_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_pending</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_pending</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileEndOfFileInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileEndOfFileInformation">[docs]</a><span class="k">class</span> <span class="nc">FileEndOfFileInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_END_OF_FILE_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endoffile</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_int64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endoffile</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileValidDataLengthInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileValidDataLengthInformation">[docs]</a><span class="k">class</span> <span class="nc">FileValidDataLengthInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_VALID_DATA_LENGTH_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_data_length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_int64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid_data_length</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileNamesInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileNamesInformation">[docs]</a><span class="k">class</span> <span class="nc">FileNamesInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_NAMES_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">next_entry_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_index</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="n">file_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="n">file_name_length</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">next_entry_offset</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="n">next_entry_offset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">upperbound</span><span class="p">)</span></div>


<div class="viewcode-block" id="FilePositionInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FilePositionInformation">[docs]</a><span class="k">class</span> <span class="nc">FilePositionInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_POSITION_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_byte_offset</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_byte_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_byte_offset</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileStandardInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileStandardInformation">[docs]</a><span class="k">class</span> <span class="nc">FileStandardInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_STANDARD_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_links</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_pending</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_links</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_pending</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="c1"># Ignore 2-bytes Reserved field</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation_size</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_of_file</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_links</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_pending</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="c1"># Ignore 2-bytes Reserved field</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileEaInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileEaInformation">[docs]</a><span class="k">class</span> <span class="nc">FileEaInformation</span><span class="p">(</span><span class="n">FileInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_EA_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ea_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span></div>


<div class="viewcode-block" id="FileFsSizeInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFsSizeInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFsSizeInformation</span><span class="p">(</span><span class="n">FileSystemInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FS_SIZE_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileSystemInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_allocation_units</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_allocation_units</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectors_per_allocation_unit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_per_sector</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_allocation_units</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_allocation_units</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectors_per_allocation_unit</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_per_sector</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span></div>


<div class="viewcode-block" id="FileFsFullSizeInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFsFullSizeInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFsFullSizeInformation</span><span class="p">(</span><span class="n">FileSystemInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FS_FULL_SIZE_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileSystemInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_allocation_units</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller_available_allocation_units</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actual_available_allocation_units</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectors_per_allocation_unit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_per_sector</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_allocation_units</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller_available_allocation_units</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actual_available_allocation_units</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sectors_per_allocation_unit</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bytes_per_sector</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span></div>


<span class="c1"># DeviceType</span>
<div class="viewcode-block" id="DeviceType"><a class="viewcode-back" href="../../model.html#pike.smb2.DeviceType">[docs]</a><span class="k">class</span> <span class="nc">DeviceType</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">FILE_DEVICE_CD_ROM</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_DEVICE_DISK</span> <span class="o">=</span> <span class="mh">0x00000007</span></div>


<span class="n">DeviceType</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="c1"># Volume Characteristics</span>
<div class="viewcode-block" id="Characteristics"><a class="viewcode-back" href="../../model.html#pike.smb2.Characteristics">[docs]</a><span class="k">class</span> <span class="nc">Characteristics</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">FILE_REMOVABLE_MEDIA</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_READ_ONLY_DEVICE</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_FLOPPY_DISKETTE</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">FILE_WRITE_ONCE_MEDIA</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">FILE_REMOTE_DEVICE</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">FILE_DEVICE_IS_MOUNTED</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">FILE_VIRTUAL_VOLUME</span> <span class="o">=</span> <span class="mh">0x00000040</span>
    <span class="n">FILE_DEVICE_SECURE_OPEN</span> <span class="o">=</span> <span class="mh">0x00000100</span>
    <span class="n">FILE_CHARACTERISTIC_TS_DEVICE</span> <span class="o">=</span> <span class="mh">0x00001000</span>
    <span class="n">FILE_CHARACTERISTIC_WEBDAV_DEVICE</span> <span class="o">=</span> <span class="mh">0x00002000</span>
    <span class="n">FILE_DEVICE_ALLOW_APPCONTAINER_TRAVERSAL</span> <span class="o">=</span> <span class="mh">0x00020000</span></div>


<span class="n">Characteristics</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="FileFsDeviceInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFsDeviceInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFsDeviceInformation</span><span class="p">(</span><span class="n">FileSystemInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FS_DEVICE_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileSystemInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_type</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">characteristics</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_type</span> <span class="o">=</span> <span class="n">DeviceType</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">characteristics</span> <span class="o">=</span> <span class="n">Characteristics</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span></div>


<span class="c1"># File System Attributes</span>
<div class="viewcode-block" id="FileSystemAtrribute"><a class="viewcode-back" href="../../model.html#pike.smb2.FileSystemAtrribute">[docs]</a><span class="k">class</span> <span class="nc">FileSystemAtrribute</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">FILE_CASE_SENSITIVE_SEARCH</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_CASE_PRESERVED_NAMES</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_UNICODE_ON_DISK</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">FILE_PERSISTENT_ACLS</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">FILE_FILE_COMPRESSION</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">FILE_VOLUME_QUOTAS</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">FILE_SUPPORTS_SPARSE_FILES</span> <span class="o">=</span> <span class="mh">0x00000040</span>
    <span class="n">FILE_SUPPORTS_REPARSE_POINTS</span> <span class="o">=</span> <span class="mh">0x00000080</span>
    <span class="n">FILE_SUPPORTS_REMOTE_STORAGE</span> <span class="o">=</span> <span class="mh">0x00000100</span>
    <span class="n">FILE_VOLUME_IS_COMPRESSED</span> <span class="o">=</span> <span class="mh">0x00008000</span>
    <span class="n">FILE_SUPPORTS_OBJECT_IDS</span> <span class="o">=</span> <span class="mh">0x00010000</span>
    <span class="n">FILE_SUPPORTS_ENCRYPTION</span> <span class="o">=</span> <span class="mh">0x00020000</span>
    <span class="n">FILE_NAMED_STREAMS</span> <span class="o">=</span> <span class="mh">0x00040000</span>
    <span class="n">FILE_READ_ONLY_VOLUME</span> <span class="o">=</span> <span class="mh">0x00080000</span>
    <span class="n">FILE_SEQUENTIAL_WRITE_ONCE</span> <span class="o">=</span> <span class="mh">0x00100000</span>
    <span class="n">FILE_SUPPORTS_TRANSACTIONS</span> <span class="o">=</span> <span class="mh">0x00200000</span>
    <span class="n">FILE_SUPPORTS_HARD_LINKS</span> <span class="o">=</span> <span class="mh">0x00400000</span>
    <span class="n">FILE_SUPPORTS_EXTENDED_ATTRIBUTES</span> <span class="o">=</span> <span class="mh">0x00800000</span>
    <span class="n">FILE_SUPPORTS_OPEN_BY_FILE_ID</span> <span class="o">=</span> <span class="mh">0x01000000</span>
    <span class="n">FILE_SUPPORTS_USN_JOURNAL</span> <span class="o">=</span> <span class="mh">0x02000000</span>
    <span class="n">FILE_SUPPORT_INTEGRITY_STREAMS</span> <span class="o">=</span> <span class="mh">0x04000000</span></div>


<span class="n">FileSystemAtrribute</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="FileFsAttributeInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFsAttributeInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFsAttributeInformation</span><span class="p">(</span><span class="n">FileSystemInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FS_ATTRIBUTE_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileSystemInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_attibutes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_component_name_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_name_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_name</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_attibutes</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_component_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_system_name_length</span><span class="p">)</span></div>


<div class="viewcode-block" id="FileFsVolumeInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFsVolumeInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFsVolumeInformation</span><span class="p">(</span><span class="n">FileSystemInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FS_VOLUME_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileSystemInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_creation_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_serial_number</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_label_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supports_objects</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_label</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_creation_time</span> <span class="o">=</span> <span class="n">nttime</span><span class="o">.</span><span class="n">NtTime</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_serial_number</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_label_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supports_objects</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">volume_label</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">volume_label_length</span><span class="p">)</span></div>


<span class="c1"># File System Control Flags</span>
<div class="viewcode-block" id="FileSystemControlFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.FileSystemControlFlags">[docs]</a><span class="k">class</span> <span class="nc">FileSystemControlFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">FILE_VC_QUOTA_TRACK</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">FILE_VC_QUOTA_ENFORCE</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">FILE_VC_CONTENT_INDEX_DISABLED</span> <span class="o">=</span> <span class="mh">0x00000008</span>
    <span class="n">FILE_VC_LOG_QUOTA_THRESHOLD</span> <span class="o">=</span> <span class="mh">0x00000010</span>
    <span class="n">FILE_VC_LOG_QUOTA_LIMIT</span> <span class="o">=</span> <span class="mh">0x00000020</span>
    <span class="n">FILE_VC_LOG_VOLUME_THRESHOLD</span> <span class="o">=</span> <span class="mh">0x00000040</span>
    <span class="n">FILE_VC_LOG_VOLUME_LIMIT</span> <span class="o">=</span> <span class="mh">0x00000080</span>
    <span class="n">FILE_VC_QUOTAS_INCOMPLETE</span> <span class="o">=</span> <span class="mh">0x00000100</span>
    <span class="n">FILE_VC_QUOTAS_REBUILDING</span> <span class="o">=</span> <span class="mh">0x00000200</span></div>


<span class="n">FileSystemControlFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="FileFsControlInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFsControlInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFsControlInformation</span><span class="p">(</span><span class="n">FileSystemInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FS_CONTROL_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileSystemInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space_start_filtering</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space_threshold</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space_stop_filtering</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_quota_threshold</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_quota_limit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_control_flags</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_int64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_space_start_filtering</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_int64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_space_threshold</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_int64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free_space_stop_filtering</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_quota_threshold</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_quota_limit</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_system_control_flags</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space_start_filtering</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space_threshold</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">free_space_stop_filtering</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_int64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_quota_threshold</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_quota_limit</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_system_control_flags</span> <span class="o">=</span> <span class="n">FileSystemControlFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span></div>


<div class="viewcode-block" id="FileFsObjectIdInformation"><a class="viewcode-back" href="../../model.html#pike.smb2.FileFsObjectIdInformation">[docs]</a><span class="k">class</span> <span class="nc">FileFsObjectIdInformation</span><span class="p">(</span><span class="n">FileSystemInformation</span><span class="p">):</span>
    <span class="n">file_information_class</span> <span class="o">=</span> <span class="n">FILE_FS_OBJECTID_INFORMATION</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">FileSystemInformation</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objectid</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extended_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objectid</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extended_info</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span></div>


<div class="viewcode-block" id="CompletionFilter"><a class="viewcode-back" href="../../model.html#pike.smb2.CompletionFilter">[docs]</a><span class="k">class</span> <span class="nc">CompletionFilter</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_NOTIFY_CHANGE_FILE_NAME</span> <span class="o">=</span> <span class="mh">0x001</span>
    <span class="n">SMB2_NOTIFY_CHANGE_DIR_NAME</span> <span class="o">=</span> <span class="mh">0x002</span>
    <span class="n">SMB2_NOTIFY_CHANGE_ATTRIBUTES</span> <span class="o">=</span> <span class="mh">0x004</span>
    <span class="n">SMB2_NOTIFY_CHANGE_SIZE</span> <span class="o">=</span> <span class="mh">0x008</span>
    <span class="n">SMB2_NOTIFY_CHANGE_LAST_WRITE</span> <span class="o">=</span> <span class="mh">0x010</span>
    <span class="n">SMB2_NOTIFY_CHANGE_LAST_ACCESS</span> <span class="o">=</span> <span class="mh">0x020</span>
    <span class="n">SMB2_NOTIFY_CHANGE_CREATION</span> <span class="o">=</span> <span class="mh">0x040</span>
    <span class="n">SMB2_NOTIFY_CHANGE_EA</span> <span class="o">=</span> <span class="mh">0x080</span>
    <span class="n">SMB2_NOTIFY_CHANGE_SECURITY</span> <span class="o">=</span> <span class="mh">0x100</span>
    <span class="n">SMB2_NOTIFY_CHANGE_STREAM_NAME</span> <span class="o">=</span> <span class="mh">0x200</span>
    <span class="n">SMB2_NOTIFY_CHANGE_STREAM_SIZE</span> <span class="o">=</span> <span class="mh">0x400</span>
    <span class="n">SMB2_NOTIFY_CHANGE_STREAM_WRITE</span> <span class="o">=</span> <span class="mh">0x800</span></div>


<span class="n">CompletionFilter</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="ChangeNotifyFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.ChangeNotifyFlags">[docs]</a><span class="k">class</span> <span class="nc">ChangeNotifyFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_WATCH_TREE</span> <span class="o">=</span> <span class="mh">0x01</span></div>


<span class="n">ChangeNotifyFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="FileNotifyInfoAction"><a class="viewcode-back" href="../../model.html#pike.smb2.FileNotifyInfoAction">[docs]</a><span class="k">class</span> <span class="nc">FileNotifyInfoAction</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">SMB2_ACTION_ADDED</span> <span class="o">=</span> <span class="mh">0x001</span>
    <span class="n">SMB2_ACTION_REMOVED</span> <span class="o">=</span> <span class="mh">0x002</span>
    <span class="n">SMB2_ACTION_MODIFIED</span> <span class="o">=</span> <span class="mh">0x003</span>
    <span class="n">SMB2_ACTION_RENAMED_OLD_NAME</span> <span class="o">=</span> <span class="mh">0x004</span>
    <span class="n">SMB2_ACTION_RENAMED_NEW_NAME</span> <span class="o">=</span> <span class="mh">0x005</span>
    <span class="n">SMB2_ACTION_ADDED_STREAM</span> <span class="o">=</span> <span class="mh">0x006</span>
    <span class="n">SMB2_ACTION_REMOVED_STREAM</span> <span class="o">=</span> <span class="mh">0x007</span>
    <span class="n">SMB2_ACTION_MODIFIED_STREAM</span> <span class="o">=</span> <span class="mh">0x008</span>
    <span class="n">SMB2_ACTION_REMOVED_BY_DELETE</span> <span class="o">=</span> <span class="mh">0x009</span></div>


<span class="n">FileNotifyInfoAction</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">FileNotifyInformation</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">startoffset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">neo</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">FileNotifyInfoAction</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="n">filenamelength</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="n">filenamelength</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">startoffset</span> <span class="o">+</span> <span class="n">neo</span>
        <span class="k">return</span> <span class="n">neo</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{0}</span><span class="s2"> </span><span class="si">{1}</span><span class="s2"> &#39;</span><span class="si">{2}</span><span class="s2">&#39;&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">ChangeNotifyResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_CHANGE_NOTIFY</span>
    <span class="n">allowed_status</span> <span class="o">=</span> <span class="p">[</span><span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_SUCCESS</span><span class="p">,</span> <span class="n">ntstatus</span><span class="o">.</span><span class="n">STATUS_NOTIFY_CLEANUP</span><span class="p">]</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">9</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">neo</span> <span class="o">=</span> <span class="n">FileNotifyInformation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">neo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>


<span class="k">class</span> <span class="nc">ChangeNotifyRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_CHANGE_NOTIFY</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">32</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_length</span> <span class="o">=</span> <span class="mi">4096</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_filter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_length</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">completion_filter</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<div class="viewcode-block" id="BreakLeaseFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.BreakLeaseFlags">[docs]</a><span class="k">class</span> <span class="nc">BreakLeaseFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_NOTIFY_BREAK_LEASE_FLAG_NONE</span> <span class="o">=</span> <span class="mh">0x00</span>
    <span class="n">SMB2_NOTIFY_BREAK_LEASE_FLAG_ACK_REQUIRED</span> <span class="o">=</span> <span class="mh">0x01</span></div>


<span class="n">BreakLeaseFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">OplockBreakNotification</span><span class="p">(</span><span class="n">Notification</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_OPLOCK_BREAK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">24</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Notification</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span> <span class="o">=</span> <span class="n">OplockLevel</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved1</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">(),</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">LeaseBreakNotification</span><span class="p">(</span><span class="n">Notification</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_OPLOCK_BREAK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">44</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Notification</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_epoch</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_lease_state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_lease_state</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_epoch</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">BreakLeaseFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_lease_state</span> <span class="o">=</span> <span class="n">LeaseState</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_lease_state</span> <span class="o">=</span> <span class="n">LeaseState</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">break_reason</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_mask_hint</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">share_mask_hint</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">OplockBreakAcknowledgement</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_OPLOCK_BREAK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">24</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Reserved2</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">LeaseBreakAcknowledgement</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_OPLOCK_BREAK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">36</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span><span class="p">)</span>
        <span class="c1"># LeaseDuration is reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">OplockBreakResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_OPLOCK_BREAK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">24</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oplock_level</span> <span class="o">=</span> <span class="n">OplockLevel</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved1</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">(),</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">LeaseBreakResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_OPLOCK_BREAK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">36</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">BreakLeaseFlags</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_key</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_state</span> <span class="o">=</span> <span class="n">LeaseState</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lease_duration</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ReadRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_READ</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">49</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_bytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">padding</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nb">super</span><span class="p">(</span><span class="n">ReadRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
                <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">@</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Padding</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">)</span>
        <span class="c1"># Reserved</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_count</span><span class="p">)</span>
        <span class="c1"># Channel</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining_bytes</span><span class="p">)</span>

        <span class="c1"># ReadChannelInfoLength</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_offset</span><span class="p">)</span>

        <span class="c1"># ReadChannelInfoLength</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read_channel_info_length</span><span class="p">)</span>

        <span class="c1"># Buffer</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint8le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ReadResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_READ</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">17</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_remaining</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">ReadResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span> <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">),]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint8le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_remaining</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="c1"># Advance to data</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>


<span class="c1"># Flag constants</span>
<div class="viewcode-block" id="WriteFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.WriteFlags">[docs]</a><span class="k">class</span> <span class="nc">WriteFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_WRITEFLAG_WRITE_THROUGH</span> <span class="o">=</span> <span class="mh">0x00000001</span></div>


<span class="n">WriteFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">WriteRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_WRITE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">49</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_bytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">WriteRequest</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">()]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">@</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># Encode 0 for buffer offset for now</span>
        <span class="n">buf_ofs</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Channel</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
        <span class="c1"># RemainingBytes</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining_bytes</span><span class="p">)</span>
        <span class="c1"># WriteChannelInfoOffset</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_offset</span><span class="p">)</span>
        <span class="c1"># WriteChannelInfoLength:</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_length</span><span class="p">)</span>
        <span class="c1"># Flags</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="c1"># Go back and set buffer offset</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_offset</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span>
        <span class="n">buf_ofs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_offset</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">WriteResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_WRITE</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">17</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_log_str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">WriteResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_log_str</span><span class="p">(),</span>
            <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remaining</span><span class="p">:</span>
            <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(remaining </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_channel_info_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>


<div class="viewcode-block" id="LockFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.LockFlags">[docs]</a><span class="k">class</span> <span class="nc">LockFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_LOCKFLAG_SHARED_LOCK</span> <span class="o">=</span> <span class="mh">0x00000001</span>
    <span class="n">SMB2_LOCKFLAG_EXCLUSIVE_LOCK</span> <span class="o">=</span> <span class="mh">0x00000002</span>
    <span class="n">SMB2_LOCKFLAG_UN_LOCK</span> <span class="o">=</span> <span class="mh">0x00000004</span>
    <span class="n">SMB2_LOCKFLAG_FAIL_IMMEDIATELY</span> <span class="o">=</span> <span class="mh">0x00000010</span></div>


<span class="n">LockFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="LockRequest"><a class="viewcode-back" href="../../model.html#pike.smb2.LockRequest">[docs]</a><span class="k">class</span> <span class="nc">LockRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    @ivar locks: A list of lock tuples, each of which consists of (offset, length, flags).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_LOCK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">48</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_sequence</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock_count</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock_count</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_count</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lock_sequence</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">lock</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">:</span>
            <span class="c1"># Offset</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="n">lock</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># Length</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="n">lock</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># Flags</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="n">lock</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c1"># Reserved</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">LockResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_LOCK</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>


<div class="viewcode-block" id="IoctlCode"><a class="viewcode-back" href="../../model.html#pike.smb2.IoctlCode">[docs]</a><span class="k">class</span> <span class="nc">IoctlCode</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">ValueEnum</span><span class="p">):</span>
    <span class="n">FSCTL_DFS_GET_REFERRALS</span> <span class="o">=</span> <span class="mh">0x00060194</span>
    <span class="n">FSCTL_PIPE_PEEK</span> <span class="o">=</span> <span class="mh">0x0011400C</span>
    <span class="n">FSCTL_PIPE_WAIT</span> <span class="o">=</span> <span class="mh">0x00110018</span>
    <span class="n">FSCTL_PIPE_TRANSCEIVE</span> <span class="o">=</span> <span class="mh">0x0011C017</span>
    <span class="n">FSCTL_SRV_COPYCHUNK</span> <span class="o">=</span> <span class="mh">0x001440F2</span>
    <span class="n">FSCTL_SRV_ENUMERATE_SNAPSHOTS</span> <span class="o">=</span> <span class="mh">0x00144064</span>
    <span class="n">FSCTL_SRV_REQUEST_RESUME_KEY</span> <span class="o">=</span> <span class="mh">0x00140078</span>
    <span class="n">FSCTL_SRV_READ_HASH</span> <span class="o">=</span> <span class="mh">0x001441BB</span>
    <span class="n">FSCTL_SRV_COPYCHUNK_WRITE</span> <span class="o">=</span> <span class="mh">0x001480F2</span>
    <span class="n">FSCTL_LMR_REQUEST_RESILIENCY</span> <span class="o">=</span> <span class="mh">0x001401D4</span>
    <span class="n">FSCTL_QUERY_NETWORK_INTERFACE_INFO</span> <span class="o">=</span> <span class="mh">0x001401FC</span>
    <span class="n">FSCTL_SET_REPARSE_POINT</span> <span class="o">=</span> <span class="mh">0x000900A4</span>
    <span class="n">FSCTL_GET_REPARSE_POINT</span> <span class="o">=</span> <span class="mh">0x000900A8</span>
    <span class="n">FSCTL_DFS_GET_REFERRALS_EX</span> <span class="o">=</span> <span class="mh">0x000601B0</span>
    <span class="n">FSCTL_FILE_LEVEL_TRIM</span> <span class="o">=</span> <span class="mh">0x00098208</span>
    <span class="n">FSCTL_VALIDATE_NEGOTIATE_INFO</span> <span class="o">=</span> <span class="mh">0x00140204</span>
    <span class="n">FSCTL_SET_ZERO_DATA</span> <span class="o">=</span> <span class="mh">0x000980C8</span>
    <span class="n">FSCTL_SET_SPARSE</span> <span class="o">=</span> <span class="mh">0x000900C4</span></div>


<span class="n">IoctlCode</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<div class="viewcode-block" id="IoctlFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.IoctlFlags">[docs]</a><span class="k">class</span> <span class="nc">IoctlFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SMB2_0_IOCTL_IS_FSCTL</span> <span class="o">=</span> <span class="mh">0x00000001</span></div>


<span class="n">IoctlFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">IoctlRequest</span><span class="p">(</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_IOCTL</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">57</span>
    <span class="n">LOG_CHILDREN_COUNT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">LOG_CHILDREN_EXPAND</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">field_blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ioctl_input&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Request</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctl_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># MS-SMB2 says that the file ID should be set to 0xffffffffffffffff for</span>
        <span class="c1"># certain IOCTLs.  Assuming that means both persistent and volatile.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xFFFFFFFFFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFFFFFFFFFF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_input_response</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_output_response</span> <span class="o">=</span> <span class="mi">256</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ioctl_input</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ioctl_input</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioctl_input</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctl_code</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ctl_code</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ioctl_ctl_code</span>

        <span class="c1"># Reserved should be set to 0</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctl_code</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_id</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Create holes where we will fill in offset and count later</span>
        <span class="n">input_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">input_count_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_input_response</span><span class="p">)</span>
        <span class="c1"># For requests, output offset and count should be 0</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_count</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_output_response</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="c1"># Reserved2 should be set to 0</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">buffer_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">input_offset_hole</span><span class="p">(</span><span class="n">buffer_start</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>

        <span class="c1"># Encode the ioctl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ioctl_input</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
        <span class="c1"># Set the ioctl count, which is the length in bytes</span>
        <span class="n">input_count_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">buffer_start</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IoctlResponse</span><span class="p">(</span><span class="n">Response</span><span class="p">):</span>
    <span class="n">command_id</span> <span class="o">=</span> <span class="n">SMB2_IOCTL</span>
    <span class="n">structure_size</span> <span class="o">=</span> <span class="mi">49</span>
    <span class="n">LOG_CHILDREN_COUNT</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">LOG_CHILDREN_EXPAND</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">field_blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ioctl_output&quot;</span><span class="p">]</span>

    <span class="c1"># Set up a map so that the correct IoctlOutput frame decoder will be called,</span>
    <span class="c1"># based on the ioctl_ctl_code defined in the IoctlOutput</span>
    <span class="n">_ioctl_ctl_code_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_ioctl_ctl_code_map</span><span class="p">,</span> <span class="s2">&quot;ioctl_ctl_code&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">Response</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ioctl_output</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ioctl_output</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioctl_output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctl_code</span> <span class="o">=</span> <span class="n">IoctlCode</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">(),</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint64le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_count</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved2</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="n">cur</span><span class="o">.</span><span class="n">advanceto</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_offset</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_count</span>

        <span class="n">ioctl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ioctl_ctl_code_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ctl_code</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">cur</span><span class="o">.</span><span class="n">bounded</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
            <span class="n">ioctl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">IoctlInput</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">ioctl_input</span> <span class="o">=</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">ValidateNegotiateInfoRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_VALIDATE_NEGOTIATE_INFO</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_guid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialects_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialects</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client_guid</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span><span class="p">)</span>

        <span class="c1"># If dialects_count was not set manually, calculate it here.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialects_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dialects_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialects</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dialects_count</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">dialect</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dialects</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="n">dialect</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">QueryNetworkInterfaceInfoRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_QUERY_NETWORK_INTERFACE_INFO</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RequestResumeKeyRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_REQUEST_RESUME_KEY</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">ioctl_input</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">NetworkResiliencyRequestRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_LMR_REQUEST_RESILIENCY</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reserved</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reserved</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CopyChunkCopyRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_COPYCHUNK</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_key</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_key</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_count</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reserved</span>
        <span class="c1"># encode the chunks</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="n">chunk</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CopyChunkCopyWriteRequest</span><span class="p">(</span><span class="n">CopyChunkCopyRequest</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_COPYCHUNK_WRITE</span>


<span class="k">class</span> <span class="nc">CopyChunk</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SetReparsePointRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SET_REPARSE_POINT</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reparse_data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reparse_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reparse_data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GetReparsePointRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_GET_REPARSE_POINT</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">EnumerateSnapshotsRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_ENUMERATE_SNAPSHOTS</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="nd">@IoctlResponse</span><span class="o">.</span><span class="n">ioctl_ctl_code</span>
<span class="k">class</span> <span class="nc">IoctlOutput</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">ioctl_output</span> <span class="o">=</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">ValidateNegotiateInfoResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_VALIDATE_NEGOTIATE_INFO</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlOutput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="n">GlobalCaps</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_guid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_mode</span> <span class="o">=</span> <span class="n">SecurityMode</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dialect</span> <span class="o">=</span> <span class="n">Dialect</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">QueryNetworkInterfaceInfoResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_QUERY_NETWORK_INTERFACE_INFO</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlOutput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">RequestResumeKeyResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_REQUEST_RESUME_KEY</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlOutput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resume_key</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resume_key</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_bytes</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">NetworkResiliencyRequestResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>

    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_LMR_REQUEST_RESILIENCY</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">CopyChunkCopyResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_COPYCHUNK</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlOutput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunks_written</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_bytes_written</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_bytes_written</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunks_written</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_bytes_written</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_bytes_written</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CopyChunkCopyWriteResponse</span><span class="p">(</span><span class="n">CopyChunkCopyResponse</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_COPYCHUNK_WRITE</span>


<span class="k">class</span> <span class="nc">SetReparsePointResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SET_REPARSE_POINT</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">GetReparsePointResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_GET_REPARSE_POINT</span>

    <span class="n">field_blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;reparse_data&quot;</span><span class="p">]</span>
    <span class="n">_reparse_tag_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">reparse_tag</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span><span class="n">_reparse_tag_map</span><span class="p">,</span> <span class="s2">&quot;reparse_tag&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlOutput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reparse_data</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reparse_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="n">reparse_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reparse_tag_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span>
        <span class="n">reparse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>


<span class="nd">@GetReparsePointResponse</span><span class="o">.</span><span class="n">reparse_tag</span>
<span class="k">class</span> <span class="nc">ReparseDataBuffer</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ReparseDataBuffer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">reparse_data</span> <span class="o">=</span> <span class="bp">self</span>


<div class="viewcode-block" id="SymbolicLinkFlags"><a class="viewcode-back" href="../../model.html#pike.smb2.SymbolicLinkFlags">[docs]</a><span class="k">class</span> <span class="nc">SymbolicLinkFlags</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">FlagEnum</span><span class="p">):</span>
    <span class="n">SYMLINK_FLAG_ABSOLUTE</span> <span class="o">=</span> <span class="mh">0x0</span>
    <span class="n">SYMLINK_FLAG_RELATIVE</span> <span class="o">=</span> <span class="mh">0x1</span></div>


<span class="n">SymbolicLinkFlags</span><span class="o">.</span><span class="n">import_items</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>


<span class="k">class</span> <span class="nc">SymbolicLinkReparseBuffer</span><span class="p">(</span><span class="n">ReparseDataBuffer</span><span class="p">):</span>
    <span class="n">reparse_tag</span> <span class="o">=</span> <span class="mh">0xA000000C</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SymbolicLinkReparseBuffer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unparsed_path_length</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for ErrorResponse only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_name_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_name_offset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reparse_tag</span><span class="p">)</span>
        <span class="n">reparse_data_length_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># reserved</span>
        <span class="n">reparse_data_len_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_offset</span><span class="p">)</span>
        <span class="n">sname_len_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pname_offset_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pname_len_hole</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">hole</span><span class="o">.</span><span class="n">encode_uint16le</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint32le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>

        <span class="n">sname_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substitute_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_length</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">sname_start</span>
        <span class="n">sname_len_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_length</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name</span>
        <span class="n">pname_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_name_offset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_name_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_length</span>
        <span class="n">pname_offset_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_name_offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_name_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_name_length</span> <span class="o">=</span> <span class="n">cur</span> <span class="o">-</span> <span class="n">pname_start</span>
        <span class="n">pname_len_hole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_name_length</span><span class="p">)</span>

        <span class="n">reparse_data_length_hole</span><span class="p">(</span><span class="n">cur</span> <span class="o">-</span> <span class="n">reparse_data_len_start</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">reparse_data_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unparsed_path_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_name_offset</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_name_length</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint16le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>

        <span class="n">buf_start</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">substitute_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">substitute_name_length</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">seekto</span><span class="p">(</span><span class="n">buf_start</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_name_offset</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_name</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">print_name_length</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">EnumerateSnapshotsResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">FSCTL_SRV_ENUMERATE_SNAPSHOTS</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EnumerateSnapshotsResponse</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_snapshots</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_snapshots_returns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_array_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshots</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_snapshots</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_snapshots_returned</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_array_size</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_uint32le</span><span class="p">()</span>
        <span class="n">snapshot_buffer</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">decode_utf16le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">snapshot_array_size</span><span class="p">)</span>
        <span class="c1"># TODO: handle the case where the buffer is too small</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">snapshots</span> <span class="o">=</span> <span class="n">snapshot_buffer</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SetZeroDataRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">IoctlCode</span><span class="o">.</span><span class="n">FSCTL_SET_ZERO_DATA</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beyond_final_zero</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">ioctl_input</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_offset</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">encode_uint64le</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beyond_final_zero</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SetZeroDataResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">IoctlCode</span><span class="o">.</span><span class="n">FSCTL_SET_ZERO_DATA</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlOutput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">ioctl_output</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">SetSparseRequest</span><span class="p">(</span><span class="n">IoctlInput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">IoctlCode</span><span class="o">.</span><span class="n">FSCTL_SET_SPARSE</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlInput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">ioctl_input</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">SetSparseResponse</span><span class="p">(</span><span class="n">IoctlOutput</span><span class="p">):</span>
    <span class="n">ioctl_ctl_code</span> <span class="o">=</span> <span class="n">IoctlCode</span><span class="o">.</span><span class="n">FSCTL_SET_SPARSE</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">IoctlOutput</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">ioctl_output</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>